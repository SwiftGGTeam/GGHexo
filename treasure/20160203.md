title: "æ¯å‘¨ Swift ç¤¾åŒºé—®ç­” 2016-02-03"
date: 2016-02-03 14:00:00
tags: [Swift, ç¤¾åŒºé—®ç­”]
categories: [Swift, iOS å¼€å‘]
permalink: swift-qa-2016-02-03

---

ä½œè€…ï¼š[shanks](http://codebuild.me)

æœ¬å‘¨å…±æ•´ç†äº† 5 ä¸ªé—®é¢˜ã€‚ä¸»è¦æ¶‰åŠåˆ°çš„çŸ¥è¯†ç‚¹æœ‰ï¼šdeferå…³é”®å­—ï¼Œemojiè¡¨æƒ…æå–ï¼Œä¾¿åˆ©æ„é€ å™¨çš„ç»§æ‰¿ï¼Œå…ƒç»„çš„å­˜åœ¨æ„Ÿå’Œå¦‚ä½•é‡å†™didSetã€‚

æœ¬å‘¨æ•´ç†é—®é¢˜å¦‚ä¸‹ï¼š

* [Is â€œdeferâ€ guaranteed to be called in Swift?](#Q1)
* [How to extract emojis from a string?](#Q2)
* [Subclassing a class that has convenience initializers.](#Q3)
* [Tuple vs Struct in Swift](#Q4)
* [Overriding didSet](#Q5)

<!--more-->


å¯¹åº”çš„ä»£ç éƒ½æ”¾åˆ°äº† github ä¸Šï¼Œæœ‰å…´è¶£çš„åŒå­¦å¯ä»¥ä¸‹è½½ä¸‹æ¥ç ”ç©¶ï¼š[ç‚¹å‡»ä¸‹è½½](https://github.com/SwiftGGTeam/SwiftCommunityWeeklyQA/tree/master/20160203)

<!--more-->

<a name="Q1"></a>

## Question1: Is â€œdeferâ€ guaranteed to be called in Swift?

[Q1é“¾æ¥åœ°å€](http://stackoverflow.com/questions/35108261/is-defer-guaranteed-to-be-called-in-swift)


### é—®é¢˜æè¿°

è¿™ä¸ªé—®é¢˜æ¯”è¾ƒæœ‰æ„æ€ï¼Œæ¥¼ä¸»è´´å‡ºä»¥ä¸‹ä»£ç ï¼Œç¬¬ä¸€ä¸ª `defer` é¡ºåˆ©æ‰§è¡Œï¼Œè€Œç¬¬äºŒä¸ª `defer` æ²¡æœ‰æ‰§è¡Œã€‚ä¸­é—´å¤¹æ‚ç€ä¸€ä¸ª `try` è¯­å¥æŠ›å‡ºäº†å¼‚å¸¸ã€‚

```
enum SomeError: ErrorType {
    case BadLuck
}

func unluckey() throws {
    print("\n\tunluckey(ğŸ’¥) -> someone will have a bad day ;)\n")
    throw SomeError.BadLuck
}

func callsUnluckey() throws {
    
    print("callsUnluckey() -> OPENING something")
    defer {
        print("callsUnluckey(ğŸ˜) -> CLOSEING something")
    }
    
    print("callsUnluckey() -> WORKING with something")
    
    try unluckey()
    print("callsUnluckey() -> will never get here so chill...")
    
    defer {
        print("callsUnluckey(ğŸ’©) -> why this is not getting called?")
    }
}

do {
    try callsUnluckey()
} catch {
    print("")
    print("someone had a bad day")
}

```

### é—®é¢˜è§£ç­”

å®˜æ–¹æ–‡æ¡£å¯¹è¿™ä¸ªéšè—é€»è¾‘åº”è¯¥æ²¡æœ‰æåˆ°ï¼Œå¦‚æœæ˜¯ç¨‹åºè¿è¡Œä¸­ï¼Œæ²¡æœ‰è¿è¡Œåˆ°  `defer` çš„ä»£ç æ®µï¼Œåœ¨å‡½æ•°ç»“æŸä¹‹å‰ï¼Œ `defer` ä»£ç ä¹Ÿä¸ä¼šæ‰§è¡Œã€‚å¤§å®¶å¯ä»¥è¯•è¯•ï¼Œå»æ‰ `try` è¯­å¥ï¼ŒåŠ ä¸Š `return` è¯­å¥ä¹Ÿæ˜¯ä¸€æ ·çš„æ•ˆæœã€‚ä¹Ÿå°±æ˜¯è¯´ã€‚ `defer` æœ€å¥½å†™åœ¨ `try` å’Œ `return` ä¹‹å‰ã€‚



<a name="Q2"></a>

## Question2: How to extract emojis from a string?

[Q2é“¾æ¥åœ°å€](http://stackoverflow.com/questions/35106059/how-to-extract-emojis-from-a-string)

### é—®é¢˜æè¿°

è¿™æ˜¯ä¸€ä¸ªçº¯çŸ¥è¯†ç‚¹çš„é—®é¢˜ï¼šå¦‚ä½•æ‰¾å‡ºå­—ç¬¦ä¸²ä¸­çš„ `emoji` è¡¨æƒ…ï¼Ÿ

### é—®é¢˜è§£ç­”

ç›´æ¥çœ‹ä»£ç æ³¨é‡Šï¼š

```
// è·å–å­—ç¬¦ç¼–ç å¯¹åº”çš„æ•°å€¼
extension Character {
    private var unicodeScalarCodePoint: Int {
        let characterString = String(self)
        let scalars = characterString.unicodeScalars
        return Int(scalars[scalars.startIndex].value)
    }
}

//æ‰©å±•å®šä¹‰å­—ç¬¦ä¸²çš„ä¸€ä¸ªè®¡ç®—å±æ€§ï¼Œå¾—åˆ°å­—ç¬¦ä¸²ä¸­çš„emojiå­—ç¬¦æ•°ç»„ã€‚
extension String {
    var emojis:[Character] {
        let emojiRanges = [0x1F601...0x1F64F, 0x2702...0x27B0] // emoji çš„èŒƒå›´ï¼Œå¯ä»¥è‡ªå·±æ‰©å……
        let emojiSet = emojiRanges.reduce(Set<Int>()) { (result, elm) -> Set<Int> in
            return result.union(elm)
        }
        return self.characters.filter { emojiSet.contains($0.unicodeScalarCodePoint) }
    }
}

let sentence = "ğŸ˜ƒ hello world ğŸ™ƒ"
sentence.emojis // ["ğŸ˜ƒ", "ğŸ™ƒ"]

```



<a name="Q3"></a>

## Question3: Subclassing a class that has convenience initializers.

[Q3é“¾æ¥åœ°å€](https://forums.developer.apple.com/thread/30537)

### é—®é¢˜æè¿°

è¯·çœ‹ä»£ç æè¿°ï¼š

```
class BaseClass {
    var property1 = 0
    
    init(property1: Int) {
        self.property1 = property1
    }
    
    convenience init(value1: Int, value2: Int) {
        self.init(property1: value1 + value2)
    }
}

class SubClass: BaseClass {
    var property2: Int?
    
    init(property2: Int) {
        super.init(property1: 10)
        self.property2 = property2
    }
}

let c1 = SubClass(property2: 4)
print(c1.property2!)

// ä»¥ä¸‹ä»£ç æŠ¥é”™
let c2 = SubClass(value1: 5, value2: 5)
print(c2.property1)

```

### é—®é¢˜è§£ç­”

`Swift` å®˜æ–¹æ•™ç¨‹é‡Œé¢è¯´æ˜äº†ï¼Œå¦‚æœè¦ç»§æ‰¿çˆ¶ç±»çš„ä¾¿åˆ©æ„é€ å™¨ï¼Œé‚£ä¹ˆå­ç±»éœ€è¦é‡å†™æ‰€æœ‰çˆ¶ç±»çš„æŒ‡å®šæ„é€ å™¨ï¼ŒæŠŠä»£ç å˜æˆä¸‹é¢çš„æ ·å­å°±è¡Œå•¦ï¼š

```
class SubClass1: BaseClass {
    var property2: Int?
    
    override init(property1: Int) {
        super.init(property1: 10)
        self.property2 = property1
    }
}

let c3 = SubClass1(property1: 4)
print(c3.property2!)

// ä»¥ä¸‹ä»£ç æŠ¥é”™
let c4 = SubClass1(value1: 5, value2: 5)
print(c4.property1)

```



<a name="Q4"></a>

## Question4: Tuple vs Struct in Swift

### é—®é¢˜é“¾æ¥

[Q4é“¾æ¥åœ°å€](http://stackoverflow.com/questions/35153873/tuple-vs-struct-in-swift)

### é—®é¢˜æè¿°

æ¥¼ä¸»çš„é—®é¢˜ï¼šç»“æ„ä½“ä¹Ÿå¯ä»¥å®šä¹‰å¤šä¸ªå±æ€§ï¼Œè€Œä¸”çœ‹èµ·æ¥æ›´åŠ é—´æ¥ï¼Œä¸ºå•¥è¿˜æœ‰å…ƒç»„( `Tuples` )è¿™æ ·çš„ä¸œè¥¿å­˜åœ¨ï¼Ÿ

### é—®é¢˜è§£ç­”

è·Ÿå¸–ä¸­æåˆ°äº†2ç‚¹ï¼Œæ¥è¯•å›¾è§£é‡Š `Tuples` çš„ä½œç”¨ï¼Œä»…ä¾›å‚è€ƒï¼š

* ç¬¬ä¸€ç‚¹ï¼šè¦å®ç°ä¸€ä¸ªç»“æ„ä½“çš„å¯¹è±¡çš„ "=" æ“ä½œç¬¦ï¼Œé‚£æˆ‘ä»¬éœ€è¦å»æ˜¾å¼çš„å®ç°å®ƒï¼Œæ¯”å¦‚ä»¥ä¸‹çš„ä¾‹å­ï¼š

```
struct Foo {
    var a : Int = 1
    var b : Double = 2.0
    var c : String = "3"
}

var a = Foo()
var b = Foo()
func == (lhs: Foo, rhs: Foo) -> Bool {
    return lhs.a == rhs.a && lhs.b == rhs.b && lhs.c == rhs.c
}

a == b

```

è€Œåœ¨å³å°†åˆ°æ¥çš„ `Swift 2.2` ä¸­ï¼Œæœ‰ä¸€ä¸ªå…³äºå…ƒç»„çš„æè®®ï¼Œå·²ç»è¢«å®ç°äº†ï¼Œè¯·å‚è§[Tuple comparison operators](https://github.com/apple/swift-evolution/blob/master/proposals/0015-tuple-comparison-operators.md), å¸¦æ¥çš„å˜åŒ–æ˜¯ï¼š
	å¦‚æœå…ƒç»„çš„ä¸­çš„å…ƒç´ ä¸ªæ•° `<=6`ï¼Œé‚£ä¹ˆç¼–è¯‘å™¨ä¼šå¸®ä½ è§£å†³å…ƒç»„æ¯”è¾ƒçš„é—®é¢˜ï¼Œå‰ææ˜¯å…ƒç´ ä¸­çš„æ»¡è¶³ `Equatable` åè®®ï¼Œå¦‚æœæ»¡è¶³ `Comparable` åè®®ï¼Œç”šè‡³æ˜¯æ”¯æŒ `<` , `<= `, `>=` , `>` ç­‰æ¯”è¾ƒæ“ä½œç¬¦ã€‚è§ä»¥ä¸‹ä¾‹å­ï¼š

```
/* ä»¥ä¸‹ä»£ç å°†åœ¨ Swift 2.2 ä¸­å®ç°ï¼Œä¸ç”¨è‡ªå·±å®ç° */
@warn_unused_result
public func == <A: Equatable, B: Equatable, C: Equatable>(lhs: (A,B,C), rhs: (A,B,C)) -> Bool {
    return lhs.0 == rhs.0 && lhs.1 == rhs.1 && lhs.2 == rhs.2
}
/* æ›´å¤šçš„æ¯”è¾ƒ ...           */

var aa = (1, 2.0, "3")
var bb = (1, 2.0, "3")

aa == bb // true
aa.0 = 2
aa == bb // false

```

* ç¬¬äºŒç‚¹ï¼š`Tuples` çš„è®¿é—®å¯ä»¥æ›´åŠ çµæ´»ï¼Œå¯ä»¥ä½¿ç”¨ `.0`,`.1`è¿™æ ·çš„è®¿é—®æ–¹å¼ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨æ ‡ç­¾ã€‚è€Œç»“æ„ä½“åªèƒ½è®¿é—®å®šä¹‰çš„å±æ€§ã€‚



<a name="Q5"></a>

## Question5: Overriding didSet

### é—®é¢˜é“¾æ¥

[Q5é“¾æ¥åœ°å€](http://stackoverflow.com/questions/35128118/overriding-didset)

### é—®é¢˜æè¿°

æ¥¼ä¸»çš„é—®é¢˜ï¼šä¸ºç¥é©¬ä¸èƒ½é‡å†™ `didSetï¼Ÿ` è§ä»¥ä¸‹ä»£ç ï¼š

```
class Foo {
    var name: String = "" { didSet { print("name has been set") } }
}

let foo = Foo();
foo.name = "test"
class Bar: Foo {
    override var name: String = "" {
        didSet {
            print("print this first")
            // print the line set in the superclass
        }
    }
}

```

### é—®é¢˜è§£ç­”

å®é™…ä¸Šï¼Œä¸æ˜¯ä¸èƒ½é‡å†™ï¼Œåœ¨é‡å†™æ—¶æŠ¥é”™ï¼šå…·æœ‰ `getter` å’Œ `setter` çš„å˜é‡ä¸èƒ½æœ‰åˆå§‹å€¼ã€‚é€‚ç”¨äºå­ç±»é‡å†™å±æ€§çš„æƒ…å†µã€‚ä¸è¿‡è¿™ä¸ªé”™è¯¯æç¤ºæœ‰ä¸€äº›æ­§ä¹‰ï¼Œåœ¨çˆ¶ç±»ä¸­ï¼Œå…¶å®æ˜¯å¯ä»¥èµ‹åˆå§‹å€¼çš„ï¼Œè§ä»¥ä¸‹ä»£ç ï¼š

```
class Foo {
    var name: String = "" { didSet { print("name has been set") } }
}

class Bar: Foo {
    override var name: String  {
        didSet {
            print("print this first")
            // print the line set in the superclass
        }
    }
}

let bar = Bar()
bar.name = "name"

```

æ›´å¤šå…³äºç»§æ‰¿å±æ€§å’Œ `didSet` çš„ä»‹ç»ï¼Œè§[å®˜æ–¹æ•™ç¨‹](http://wiki.jikexueyuan.com/project/swift/chapter2/13_Inheritance.html#overriding)
