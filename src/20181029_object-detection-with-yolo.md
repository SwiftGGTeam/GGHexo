 title: "ä½¿ç”¨ YOLO è¿›è¡Œå®æ—¶ç›®æ ‡æ£€æµ‹"
 date: 2018-10-29
 tags: [æœºå™¨å­¦ä¹ ]
 categories: [machinethink]
 permalink: object-detection-with-yolo
 keywords:è®¡ç®—æœºè§†è§‰ï¼Œç›®æ ‡æ£€æµ‹ï¼ŒYOLOï¼Œæœºå™¨å­¦ä¹ 
 description: æœ¬æ–‡è¯¦ç»†ä»‹ç»äº†ä½¿ç”¨ YOLO è¿›è¡Œå®æ—¶ç›®æ ‡æ£€æµ‹çš„åŸç†ï¼Œä»¥åŠåœ¨ iOS ä¸Šçš„åº”ç”¨ã€‚
 ---
 åŸæ–‡é“¾æ¥=http://machinethink.net/blog/object-detection-with-yolo/
 ä½œè€…=Matthijs Hollemans
 åŸæ–‡æ—¥æœŸ=2018/03/28
 è¯‘è€…=é˜³ä»”
 æ ¡å¯¹=numbbbbb,å°é“åŒ Linus
 å®šç¨¿=Forelax

 <!--æ­¤å¤„å¼€å§‹æ­£æ–‡-->

ç›®æ ‡æ£€æµ‹æ˜¯è®¡ç®—æœºè§†è§‰ä¸­çš„ç»å…¸é—®é¢˜ä¹‹ä¸€ï¼š

è¯†åˆ«ä¸€å¹…å›¾åƒä¸­æœ‰å“ªäº›ç›®æ ‡ï¼Œä»¥åŠå®ƒä»¬åœ¨å›¾åƒä¸­çš„ä½ç½®ã€‚

æ£€æµ‹æ˜¯ä¸€ä¸ªæ¯”åˆ†ç±»æ›´å¤æ‚çš„é—®é¢˜ï¼Œå› ä¸ºåˆ†ç±»ä¹Ÿå¯ä»¥è¯†åˆ«ç›®æ ‡ï¼Œä½†ä¸èƒ½å‡†ç¡®åˆ¤æ–­ç›®æ ‡åœ¨å›¾åƒä¸­çš„ä½ç½®â€”â€”å¹¶ä¸”åˆ†ç±»ä¸èƒ½é€‚ç”¨äºåŒ…å«å¤šä¸ªç›®æ ‡çš„å›¾åƒã€‚

![](http://machinethink.net/images/yolo/ClassificationVsDetection.png)

[YOLO](https://pjreddie.com/darknet/yolo/) æ˜¯ä¸€ä¸ªå®æ—¶æœ‰æ•ˆçš„ç›®æ ‡æ£€æµ‹ç¥ç»ç½‘ç»œã€‚

åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘å°†é˜è¿°å¦‚ä½•ä½¿ç”¨ Metal Performance Shaders æ¥å°†â€œç®€åŒ–ç‰ˆâ€ YOLOv2 è¿è¡Œåœ¨ iOS è®¾å¤‡ä¸Šã€‚

<!--more-->

åœ¨ç»§ç»­é˜…è¯»ä¹‹å‰ï¼Œè¯·å…ˆ [è§‚çœ‹è¿™ä¸ªä»¤äººæƒŠå¹çš„ YOLOv2 ä»‹ç»è§†é¢‘](https://www.youtube.com/watch?v=VOC3huqHrss)ã€‚

### YOLO çš„å·¥ä½œåŸç†

ä½ å¯ä»¥ä½¿ç”¨ [VGGNet](http://machinethink.net/blog/convolutional-neural-networks-on-the-iphone-with-vggnet/) æˆ– [Inception](https://github.com/hollance/Forge/tree/master/Examples/Inception) è¿™æ ·çš„åˆ†ç±»å™¨ï¼Œé€šè¿‡ä¸€ä¸ªå°çš„æ»‘åŠ¨çª—å£å¯¹å›¾åƒè¿›è¡Œéå†ï¼Œä»è€Œå½¢æˆä¸€ä¸ªç›®æ ‡æ£€æµ‹å™¨ã€‚æ¯ä¸€æ­¥éå†è¿è¡Œä¸€æ¬¡åˆ†ç±»å™¨ï¼Œæ¥å¯¹å½“å‰çª—å£ä¸­çš„ç›®æ ‡è¿›è¡Œåˆ†ç±»ã€‚ä½¿ç”¨è¿™æ ·çš„æ»‘åŠ¨çª—å£ï¼Œä¼šå¯¹ä¸€å¹…å›¾åƒè¾“å‡ºæˆç™¾ä¸Šåƒçš„æ£€æµ‹ç»“æœï¼Œä½†ä½ åªéœ€è¦ä¿ç•™åˆ†ç±»å™¨æœ€ç¡®å®šçš„é‚£äº›ç»“æœã€‚

è¿™ç§æ–¹æ³•æ˜¯å¯è¡Œçš„ï¼Œä½†å¾ˆæ˜¾ç„¶ä¼šå¾ˆæ…¢ï¼Œå› ä¸ºéœ€è¦è¿è¡Œå¾ˆå¤šéåˆ†ç±»å™¨ã€‚ä¸€ç§æ•ˆç‡ç¨å¾®é«˜ä¸€ç‚¹çš„æ–¹æ³•æ˜¯ï¼Œé¦–å…ˆåˆ¤æ–­å›¾åƒçš„å“ªä¸€éƒ¨åˆ†åŒ…å«äº†æœ‰æ•ˆçš„ä¿¡æ¯â€”â€”ä¹Ÿå°±æ˜¯å€™é€‰åŒºåŸŸ (region proposals)â€”â€”ç„¶åä»…ä»…åœ¨è¿™äº›åŒºåŸŸä¸­è¿è¡Œåˆ†ç±»å™¨ã€‚è¿™ç§æ–¹æ³•æ¯”æ»‘åŠ¨çª—å£çš„æ–¹æ³•èƒ½å‡å°‘åˆ†ç±»å™¨çš„è¿è¡Œæ¬¡æ•°ï¼Œä½†ä»ç„¶å¾ˆå¤šã€‚

YOLO é‡‡ç”¨äº†ä¸€ç§å®Œå…¨ä¸åŒçš„æ–¹æ³•ã€‚å®ƒå¹¶ä¸æ˜¯å°†ä¼ ç»Ÿçš„åˆ†ç±»å™¨æ”¹é€ æˆæ£€æµ‹å™¨ã€‚YOLO å®é™…ä¸Šåªå¯¹å›¾åƒè¿›è¡Œä¸€æ¬¡æ“ä½œï¼ˆä¹Ÿå°±æ˜¯å®ƒåå­—çš„ç”±æ¥ï¼šYou Only Look Onceï¼‰ï¼Œä½†æ˜¯æ˜¯ä»¥ä¸€ç§èªæ˜çš„æ–¹å¼ã€‚

YOLO å°†å›¾åƒåˆ†æˆ 13Ã—13 çš„ç½‘æ ¼å•å…ƒï¼š

![](http://machinethink.net/images/yolo/Grid.png)

æ¯ä¸€ä¸ªç½‘æ ¼å•å…ƒè´Ÿè´£é¢„æµ‹ 5 ä¸ªæ£€æµ‹æ¡†ã€‚ä¸€ä¸ªæ£€æµ‹æ¡†æ˜¯åŒ…å«ä¸€ä¸ªç›®æ ‡çš„çŸ©å½¢åŒºåŸŸã€‚

YOLO åŒæ—¶ä¼šç»™å‡ºä¸€ä¸ªç½®ä¿¡åº¦ï¼Œæè¿°äº†æŸä¸ªæ£€æµ‹æ¡†ç¡®å®åŒ…å«äº†æŸç›®æ ‡çš„ç¡®å®šç¨‹åº¦ã€‚è¿™ä¸ªå€¼å’Œæ£€æµ‹æ¡†ä¸­æ˜¯ä»€ä¹ˆç›®æ ‡æ¯«æ— å…³ç³»ï¼Œåªå’Œæ£€æµ‹æ¡†çš„å½¢çŠ¶å¤§å°åŒ¹é…ç¨‹åº¦æœ‰å…³ã€‚

é¢„æµ‹å‡ºçš„æ£€æµ‹æ¡†çœ‹èµ·æ¥å’Œä¸‹å›¾ç±»ä¼¼ï¼ˆç½®ä¿¡åº¦è¶Šé«˜ï¼Œæ¡†è¶Šç²—ï¼‰ï¼š

![](http://machinethink.net/images/yolo/Boxes.png)

å¯¹æ¯ä¸ªæ£€æµ‹æ¡†ï¼Œå¯¹åº”çš„ç½‘æ ¼å•å…ƒè¿˜ç»™å‡ºäº†ä¸€ä¸ªåˆ†ç±»çš„é¢„æµ‹ã€‚è¿™å’Œåˆ†ç±»å™¨çš„å·¥ä½œç›¸ä¼¼ï¼šå®ƒç»™å‡ºä¸€ä¸ªå…¨éƒ¨å¯èƒ½çš„ç±»åˆ«çš„æ¦‚ç‡åˆ†å¸ƒã€‚æˆ‘ä»¬ä½¿ç”¨çš„è¿™ä¸ªç‰ˆæœ¬çš„ YOLO æ˜¯ç”¨ [PASCAL VOC dataset](http://host.robots.ox.ac.uk/pascal/VOC/) è®­ç»ƒçš„ï¼Œå¯ä»¥æ£€æµ‹ 20 ç§ä¸åŒçš„ç±»åˆ«ï¼Œæ¯”å¦‚ï¼š

- è‡ªè¡Œè½¦
- èˆ¹
- æ±½è½¦
- çŒ«
- ç‹—
- äºº
- ç­‰ç­‰

æ£€æµ‹æ¡†çš„ç½®ä¿¡åº¦å’Œåˆ†ç±»é¢„æµ‹æœ€ç»ˆè¢«æ•´åˆæˆä¸€ä¸ªæœ€ç»ˆå¾—åˆ†ï¼Œæ¥å‘Šè¯‰æˆ‘ä»¬è¯¥æ£€æµ‹æ¡†å†…åŒ…å«ä¸€ä¸ªç‰¹å®šç±»å‹çš„ç›®æ ‡çš„æ¦‚ç‡ã€‚ä¾‹å¦‚ï¼Œå·¦è¾¹è¿™ä¸ªåˆå¤§åˆç²—çš„é»„è‰²æ¡†å‘Šè¯‰æˆ‘ä»¬ï¼Œ85% çš„æ¦‚ç‡è¿™é‡Œé¢åŒ…å«ä¸€åªç‹—ï¼š

![](http://machinethink.net/images/yolo/Scores.png)

å› ä¸ºæ•´å¹…å›¾åƒåŒ…å« 13Ã—13 = 169 ä¸ªç½‘æ ¼å•å…ƒï¼Œä¸”æ¯ä¸ªç½‘æ ¼å•å…ƒé¢„æµ‹ 5 ä¸ªæ£€æµ‹æ¡†ï¼Œæˆ‘ä»¬æœ€åæ€»è®¡èƒ½å¾—åˆ° 845 ä¸ªæ£€æµ‹æ¡†ã€‚å®é™…ä¸Šï¼Œè¿™å…¶ä¸­å¤§å¤šæ•°çš„æ£€æµ‹æ¡†çš„ç½®ä¿¡åº¦éƒ½å¾ˆä½ï¼Œæ‰€ä»¥ï¼Œæˆ‘ä»¬åªéœ€è¦ä¿ç•™æœ€ç»ˆå¾—åˆ†å¤§äºç­‰äº 30% çš„æ£€æµ‹æ¡†å°±è¡Œäº†ï¼ˆä½ ä¹Ÿå¯ä»¥æ ¹æ®éœ€è¦çš„æ£€æµ‹å‡†ç¡®åº¦æ”¹å˜è¿™ä¸ªé˜ˆå€¼ï¼‰ã€‚

æœ€ç»ˆçš„æ£€æµ‹ç»“æœï¼š

![](http://machinethink.net/images/yolo/Prediction.png)

ä» 845 ä¸ªæ£€æµ‹æ¡†ä¸­ï¼Œæˆ‘ä»¬åªä¿ç•™äº†è¿™ä¸‰ä¸ªï¼Œå› ä¸ºå®ƒä»¬ç»™å‡ºçš„ç»“æœæœ€å¥½ã€‚å°½ç®¡æˆ‘ä»¬æœ‰ 845 ä¸ªæ£€æµ‹æ¡†ï¼Œä½†å®ƒä»¬éƒ½æ˜¯åŒæ—¶å¾—åˆ°çš„â€”â€”ç¥ç»ç½‘ç»œåªéœ€è¦è¿è¡Œä¸€æ¬¡ã€‚è¿™ä¹Ÿæ˜¯ YOLO å¼ºå¤§è€Œå¿«é€Ÿçš„åŸå› ã€‚

ï¼ˆä»¥ä¸Šå›¾ç‰‡æ¥è‡ª [pjreddie.com](https://pjreddie.com/)ï¼‰

### ç¥ç»ç½‘ç»œ

YOLO çš„ç»“æ„åªæ˜¯ä¸€ä¸ªç®€å•çš„å·ç§¯ç¥ç»ç½‘ç»œï¼š

```
Layer         kernel  stride  output shape
---------------------------------------------
Input                          (416, 416, 3)
Convolution    3Ã—3      1      (416, 416, 16)
MaxPooling     2Ã—2      2      (208, 208, 16)
Convolution    3Ã—3      1      (208, 208, 32)
MaxPooling     2Ã—2      2      (104, 104, 32)
Convolution    3Ã—3      1      (104, 104, 64)
MaxPooling     2Ã—2      2      (52, 52, 64)
Convolution    3Ã—3      1      (52, 52, 128)
MaxPooling     2Ã—2      2      (26, 26, 128)
Convolution    3Ã—3      1      (26, 26, 256)
MaxPooling     2Ã—2      2      (13, 13, 256)
Convolution    3Ã—3      1      (13, 13, 512)
MaxPooling     2Ã—2      1      (13, 13, 512)
Convolution    3Ã—3      1      (13, 13, 1024)
Convolution    3Ã—3      1      (13, 13, 1024)
Convolution    1Ã—1      1      (13, 13, 125)
---------------------------------------------
```

è¯¥ç¥ç»ç½‘ç»œå…·æœ‰å…¸å‹çš„ç»“æ„ï¼šä¸€ä¸ª 3Ã—3 å·ç§¯æ ¸çš„å·ç§¯å±‚ï¼Œé‡‡æ ·çª—å£ 2Ã—2 çš„æ± åŒ–å±‚ã€‚æ²¡æœ‰èŠ±å“¨çš„ä¸œè¥¿ã€‚YOLO ä¸­æ²¡æœ‰å…¨è¿æ¥å±‚ã€‚

> æ³¨æ„ï¼šæˆ‘ä»¬ä½¿ç”¨çš„â€œç®€åŒ–ç‰ˆâ€ YOLO åªæœ‰ 9 ä¸ªå·ç§¯å±‚å’Œ 6 ä¸ªæ± åŒ–å±‚ã€‚å®Œå…¨ç‰ˆ YOLOv2 æ¨¡å‹åˆ†å±‚æ•°æ˜¯è¿™ä¸ªçš„ä¸‰å€ï¼Œå¹¶ä¸”ä¼šæ›´å¤æ‚ä¸€äº›ï¼Œä½†ä»ç„¶æ˜¯ä¸€ä¸ªå¸¸è§„çš„å·ç§¯ç¥ç»ç½‘ç»œã€‚
> 

æœ€åä¸€ä¸ªå·ç§¯å±‚çš„å·ç§¯æ ¸ä¸º 1Ã—1ï¼Œæ˜¯ä¸ºäº†å°†å‚æ•°é™ç»´è‡³ 13Ã—13Ã—125ã€‚å…¶ä¸­çš„ 13Ã—13 çœ‹èµ·æ¥å¾ˆç†Ÿæ‚‰ï¼šè¿™å°±æ˜¯å›¾åƒè¢«åˆ’åˆ†æˆçš„ç½‘æ ¼å•å…ƒçš„æ•°é‡ã€‚

å› æ­¤ï¼Œæ¯ä¸ªç½‘æ ¼å•å…ƒæœ‰ 125 ä¸ªé€šé“ã€‚è¿™ 125 ä¸ªé€šé“åŒ…å«äº†æ£€æµ‹æ¡†çš„æ•°æ®ï¼Œä»¥åŠåˆ†ç±»é¢„æµ‹çš„æ•°æ®ã€‚ä¸ºä»€ä¹ˆæ˜¯ 125 å‘¢ï¼Ÿå› ä¸ºæ¯ä¸ªç½‘æ ¼å•å…ƒé¢„æµ‹ 5 ä¸ªæ£€æµ‹æ¡†çš„ç»“æœï¼Œæ¯ä¸ªæ£€æµ‹æ¡†ç”± 25 ä¸ªæ•°æ®å…ƒç´ æ¥æè¿°ï¼š

- æ£€æµ‹æ¡†çŸ©å½¢çš„ xï¼Œyï¼Œå®½ï¼Œé«˜
- ç½®ä¿¡åº¦
- åœ¨ 20 ä¸ªåˆ†ç±»ä¸Šçš„æ¦‚ç‡åˆ†å¸ƒ

YOLO çš„ä½¿ç”¨å¾ˆç®€å•ï¼šè¾“å…¥ä¸€å¹…å›¾åƒï¼ˆå¤§å°ä¸º 416Ã—416 åƒç´ ï¼‰ï¼Œå®ƒè¿è¡Œä¸€æ¬¡å·ç§¯ç½‘ç»œï¼Œè¾“å‡ºä¸€ä¸ª 13Ã—13Ã—125 çš„å¼ é‡ï¼Œæè¿°ç½‘æ ¼å•å…ƒä»¥åŠæ£€æµ‹æ¡†ã€‚ä½ éœ€è¦åšçš„åªæ˜¯è®¡ç®—æ¯ä¸ªæ£€æµ‹æ¡†çš„æœ€ç»ˆå¾—åˆ†ï¼Œå¹¶æŠ›å¼ƒä½äº 30% çš„é‚£äº›ã€‚

> å°æç¤ºï¼šè¦äº†è§£æ›´å¤šæœ‰å…³ YOLO çš„å·¥ä½œåŸç†ï¼Œä»¥åŠ YOLO æ˜¯å¦‚ä½•è®­ç»ƒçš„ï¼Œè¯· [è§‚çœ‹å¯¹å®ƒçš„å‘æ˜è€…ä¹‹ä¸€çš„è®¿è°ˆ](https://www.youtube.com/watch?v=NM6lrxy0bxs)ã€‚è¿™ä¸ªè§†é¢‘ä»‹ç»çš„æ˜¯ YOLOv1ï¼Œç”±äºæ˜¯è€ç‰ˆæœ¬ï¼Œç»“æ„ç¨æœ‰ä¸åŒï¼Œä½†ä¸»ä½“æ€æƒ³æ˜¯ç›¸åŒçš„ã€‚å¾ˆå€¼å¾—è§‚çœ‹ï¼
>

### è½¬æ¢æˆ Metal

ä¸Šæ–‡æè¿°çš„æ˜¯ç®€åŒ–ç‰ˆçš„ YOLOï¼Œä¹Ÿæ˜¯æˆ‘ä»¬å°†åœ¨ iOS åº”ç”¨ä¸­ä½¿ç”¨çš„ç‰ˆæœ¬ã€‚å®Œå…¨ç‰ˆ YOLOv2 çš„ç¥ç»ç½‘ç»œæœ‰ä¸‰å€çš„åˆ†å±‚æ•°ï¼Œå› ä¸ºå¤ªå¤§ï¼Œæ‰€ä»¥åœ¨å½“å‰çš„ iPhone è®¾å¤‡ä¸Šä¸èƒ½å¿«é€Ÿè¿è¡Œã€‚ç®€åŒ–ç‰ˆçš„ YOLO ä½¿ç”¨æ›´å°‘çš„åˆ†å±‚æ•°ï¼Œå› æ­¤è¿è¡Œä¼šæ›´å¿«ï¼Œä½†å‡†ç¡®åº¦ä¹Ÿç¨å·®ã€‚

![](http://machinethink.net/images/yolo/CatOrDog.png)

YOLO ä½¿ç”¨ Darknet ç¼–å†™ï¼Œè¿™æ˜¯ YOLO ä½œè€…è‡ªå·±ç¼–å†™çš„æ·±åº¦å­¦ä¹ æ¡†æ¶ã€‚èƒ½ä¸‹è½½åˆ°çš„éƒ½æ˜¯ Darknet æ ¼å¼ã€‚å°½ç®¡ [Darknet æ˜¯å¼€æºçš„](https://github.com/pjreddie/darknet)ï¼Œæˆ‘ä¹Ÿä¸æƒ³èŠ±å¾ˆå¤šæ—¶é—´å»å¼„æ¸…å®ƒçš„å·¥ä½œåŸç†ã€‚

å¹¸è¿çš„æ˜¯ï¼Œ[æœ‰äºº](https://github.com/allanzelener/YAD2K/) å·²ç»åšäº†è¿™ä»¶äº‹ï¼Œå°† Darknet æ¨¡å‹è½¬æ¢æˆäº†æˆ‘æ‰€ä½¿ç”¨çš„æ·±åº¦å­¦ä¹ å·¥å…· Kerasã€‚æˆ‘æ‰€è¦åšçš„ï¼Œå°±æ˜¯è¿è¡Œè¿™ä¸ªâ€œYAD2Kâ€è„šæœ¬ï¼Œå°† Darknet è½¬æ¢æˆ Keras æ ¼å¼ï¼Œç„¶åç”¨æˆ‘è‡ªå·±å†™çš„è„šæœ¬å°† Keras è½¬æ¢æˆ Metalã€‚

ä½†æ˜¯ï¼Œæœ‰ä¸€ç‚¹å°éº»çƒ¦ã€‚YOLO åœ¨å®ƒçš„å·ç§¯å±‚åï¼Œä½¿ç”¨äº†ä¸€ç§å«åšâ€æ‰¹æ ‡å‡†åŒ–â€œçš„è§„æ•´åŒ–æ–¹æ³•ã€‚

â€œæ‰¹æ ‡å‡†åŒ–â€çš„æ€æƒ³æ˜¯ï¼Œå½“æ•°æ®æ˜¯å¹²å‡€çš„æ—¶å€™ï¼Œç¥ç»ç½‘ç»œèƒ½å¤Ÿè¾¾åˆ°æœ€å¥½çš„å·¥ä½œæ•ˆæœã€‚ç†æƒ³æƒ…å†µä¸‹ï¼Œä¸€ä¸ªå±‚çº§çš„è¾“å…¥æ•°æ®çš„å¹³å‡å€¼ä¸º 0ï¼Œä¸”æ–¹å·®è¾ƒå°ã€‚æ¯ä¸ªåšè¿‡æœºå™¨å­¦ä¹ çš„äººéƒ½åº”æ¯”è¾ƒç†Ÿæ‚‰è¿™ä¸€æ€æƒ³ï¼Œå› ä¸ºæˆ‘ä»¬ç»å¸¸ä½¿ç”¨ä¸€ç§ç§°ä¸ºâ€œç‰¹å¾ç¼©æ”¾â€æˆ–â€œç™½åŒ–â€çš„æŠ€æœ¯æ¥å¤„ç†æˆ‘ä»¬çš„è¾“å…¥æ•°æ®ï¼Œä»¥è¾¾åˆ°è¿™ä¸€ç›®çš„ã€‚

æ‰¹æ ‡å‡†åŒ–å¯¹å±‚é—´æ•°æ®åšäº†ç±»ä¼¼ç‰¹å¾ç¼©æ”¾çš„å¤„ç†ã€‚è¿™ç§å¤„ç†èƒ½é˜²æ­¢æ•°æ®åœ¨ç¥ç»ç½‘ç»œä¸­ä¼ é€’æ—¶é€€åŒ–ï¼Œä»è€Œæœ‰æ•ˆæå‡ç¥ç»ç½‘ç»œçš„æ€§èƒ½ã€‚

ä¸ºäº†è®©ä½ ç›´è§‚æ„Ÿå—åˆ°æ‰¹æ ‡å‡†åŒ–çš„ä½œç”¨ï¼Œä»¥ä¸‹æ˜¯ç¬¬ä¸€ä¸ªå·ç§¯å±‚åˆ†åˆ«åœ¨åº”ç”¨å’Œæœªåº”ç”¨æ‰¹æ ‡å‡†åŒ–çš„æƒ…å†µä¸‹çš„è¾“å‡ºç›´æ–¹å›¾ï¼š

![](http://machinethink.net/images/yolo/BatchNorm.png)

æ‰¹æ ‡å‡†åŒ–åœ¨è®­ç»ƒä¸€ä¸ªæ·±åº¦ç½‘ç»œæ—¶å¾ˆé‡è¦ï¼Œä½†äº‹å®ä¸Šï¼Œæˆ‘ä»¬åœ¨è¿›è¡Œæ¨æ–­çš„æ—¶å€™å¯ä»¥ä¸éœ€è¦è¿™ä¸€å¤„ç†ã€‚ä¸éœ€è¦è¿›è¡Œæ‰¹æ ‡å‡†åŒ–çš„è®¡ç®—ï¼Œæœ‰åŠ©äºä½¿æˆ‘ä»¬çš„åº”ç”¨è¿è¡Œæ›´å¿«ã€‚åœ¨ä»»ä½•æ—¶å€™ï¼ŒMetal éƒ½æ²¡æœ‰ä¸€ä¸ª `MPSCNNBatchNormalization` å±‚ã€‚

æ‰¹æ ‡å‡†åŒ–é€šå¸¸å‘ç”Ÿåœ¨å·ç§¯å±‚ä¹‹åï¼Œæ¿€æ´»å‡½æ•°ï¼ˆYOLO ä¸­çš„ ReLU å‡½æ•°ï¼‰ä¹‹å‰ã€‚å·ç§¯æ“ä½œå’Œæ‰¹æ ‡å‡†åŒ–æ“ä½œéƒ½æ˜¯å¯¹æ•°æ®è¿›è¡Œçº¿æ€§å˜æ¢ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥å°†æ‰¹æ ‡å‡†åŒ–å±‚çš„å‚æ•°å’Œå·ç§¯æƒé‡ç›¸ç»“åˆã€‚è¿™ç§°ä¸ºå°†æ‰¹æ ‡å‡†åŒ–å±‚â€œæŠ˜å â€åˆ°å·ç§¯å±‚ã€‚

é•¿è¯çŸ­è¯´ï¼Œä½¿ç”¨ä¸€äº›æ•°å­¦æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥çœç•¥æ‰¹æ ‡å‡†åŒ–å±‚ï¼Œä½†éœ€è¦æ”¹å˜å‰åºå·ç§¯å±‚çš„æƒé‡ã€‚

å¿«é€Ÿé˜è¿°ä¸€ä¸‹å·ç§¯å±‚çš„è®¡ç®—è¿‡ç¨‹ï¼šè®¾ `x` æ˜¯è¾“å…¥å›¾åƒä¸­çš„åƒç´ ï¼Œ`w` æ˜¯å·ç§¯å±‚æƒé‡ï¼Œé‚£ä¹ˆï¼Œç»è¿‡å·ç§¯å±‚è®¡ç®—ï¼Œè¾“å‡ºçš„æ¯ä¸ªåƒç´ çš„å€¼ä¸ºï¼š

```
out[j] = x[i]*w[0] + x[i+1]*w[1] + x[i+2]*w[2] + ... + x[i+k]*w[k] + b
```

å³è¾“å…¥åƒç´ çŸ©é˜µå’Œå·ç§¯æ ¸æƒé‡çš„ç‚¹ç§¯ï¼Œå†åŠ ä¸Šåå·®é¡¹ `b`ã€‚

ä»¥ä¸‹æ˜¯å¯¹å·ç§¯å±‚è¾“å‡ºè¿›è¡Œæ‰¹æ ‡å‡†åŒ–å¤„ç†çš„è®¡ç®—è¿‡ç¨‹ï¼š

```
        gamma * (out[j] - mean)
bn[j] = ---------------------- + beta
            sqrt(variance)
```

æ‰¹æ ‡å‡†åŒ–é¦–å…ˆå¯¹æ¯ä¸ªåƒç´ çš„è¾“å‡ºå€¼å‡å»å¹³å‡å€¼ `mean`ï¼Œå†é™¤ä»¥æ ‡å‡†å·®ï¼Œä¹˜ä»¥ä¸€ä¸ªç¼©æ”¾ç³»æ•° `gamma`ï¼Œå†åŠ ä¸Šä¸€ä¸ªåç§»å€¼ `beta`ã€‚è¿™å››ä¸ªå‚æ•° â€”â€” `mean`ï¼Œ`variance`ï¼Œ`gamma`ï¼Œ`beta` â€”â€” æ˜¯åœ¨ç½‘ç»œè®­ç»ƒè¿‡ç¨‹ä¸­ï¼Œæ‰¹æ ‡å‡†åŒ–å±‚å­¦ä¹ å¾—åˆ°çš„ã€‚

ä¸ºäº†çœç•¥æ‰¹æ ‡å‡†åŒ–ï¼Œæˆ‘ä»¬å¯ä»¥å°†è¿™ä¸¤ä¸ªå…¬å¼è¿›è¡Œç¨å¾®çš„æ•´åˆï¼Œæ¥ä¸ºå·ç§¯å±‚è®¡ç®—æ–°çš„æƒé‡å’Œåå·®é¡¹ï¼š

```
           gamma * w
w_new = --------------
        sqrt(variance)

        gamma*(b - mean)
b_new = ---------------- + beta
         sqrt(variance)
```

åˆ©ç”¨è¿™äº›æ–°çš„æƒé‡å’Œåå·®é¡¹å¯¹è¾“å…¥ `x` è¿›è¡Œå·ç§¯æ“ä½œï¼Œèƒ½å¤Ÿå¾—åˆ°ä¸åŸæ¥å·ç§¯å±‚åŠ ä¸Šæ‰¹æ ‡å‡†åŒ–å¤„ç†ååŒæ ·çš„ç»“æœã€‚

ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥å»æ‰æ‰¹æ ‡å‡†åŒ–å±‚ï¼Œåªä½¿ç”¨å·ç§¯å±‚ï¼Œä½†å‚æ•°æ˜¯ç»è¿‡è°ƒèŠ‚çš„æƒé‡å’Œåå·®é¡¹ `w_new` å’Œ `b_new`ã€‚æˆ‘ä»¬å¯¹ç½‘ç»œä¸­æ‰€æœ‰çš„å·ç§¯å±‚éƒ½é‡å¤è¿™ä¸€è¿‡ç¨‹ã€‚

> æ³¨æ„ï¼šäº‹å®ä¸Šï¼ŒYOLO ä¸­çš„å·ç§¯å±‚æ²¡æœ‰ä½¿ç”¨åå·®é¡¹ï¼Œå› æ­¤ä¸Šè¿°å…¬å¼ä¸­ b ä¸º 0ã€‚ä½†è¯·æ³¨æ„ï¼Œç»è¿‡æ•´åˆæ‰¹æ ‡å‡†åŒ–çš„å‚æ•°åï¼Œå·ç§¯å±‚å°±æœ‰äº†åå·®é¡¹ã€‚
> 

ä¸€æ—¦æˆ‘ä»¬å°†æ‰€æœ‰çš„æ‰¹æ ‡å‡†åŒ–å±‚æ•´åˆåˆ°äº†å®ƒä»¬çš„å‰åºå·ç§¯å±‚ï¼Œæˆ‘ä»¬å°±å¯ä»¥å°†æƒé‡è½¬æ¢åˆ° Metal äº†ã€‚ç®€å•åœ°å°†è¯¥æ•°ç»„ï¼ˆKeras ä¸­å­˜å‚¨çš„é¡ºåºå’Œ Metal ä¸åŒï¼‰è¿›è¡Œè½¬ç½®ï¼Œå†å°†å…¶å†™è¿› 32 ä½æµ®ç‚¹æ•°çš„äºŒè¿›åˆ¶æ–‡ä»¶ã€‚

å¦‚æœä½ å¯¹è¿™äº›æ“ä½œæ„Ÿåˆ°å¥½å¥‡ï¼Œä½ å¯ä»¥æŸ¥çœ‹è½¬æ¢è„šæœ¬ [yolo2metal.py](https://github.com/hollance/Forge/blob/master/Examples/YOLO/yolo2metal.py) æ¥è·å¾—è¯¦ç»†ä¿¡æ¯ã€‚ä¸ºäº†éªŒè¯æ•´åˆæ‰¹æ ‡å‡†åŒ–çš„æ•ˆæœï¼Œè„šæœ¬åˆ›å»ºäº†ä¸€ä¸ªä¸åŒ…å«æ‰¹æ ‡å‡†åŒ–å±‚ï¼Œä½†ä½¿ç”¨äº†è°ƒèŠ‚åçš„æƒé‡çš„æ¨¡å‹ï¼Œå¹¶å°†å…¶ä¸åŸå§‹æ¨¡å‹çš„é¢„æµ‹ç»“æœè¿›è¡Œæ¯”å¯¹ã€‚

### iOS åº”ç”¨

æˆ‘ç†æ‰€å½“ç„¶åœ°ä½¿ç”¨ [Forge](https://github.com/hollance/Forge) æ¥ç¼–å†™æˆ‘çš„ iOS åº”ç”¨ã€‚ğŸ˜‚ä½ å¯ä»¥åœ¨ [YOLO](https://github.com/hollance/Forge/tree/master/Examples/YOLO) æ–‡ä»¶å¤¹ä¸­æ‰¾åˆ°æºä»£ç ã€‚å¦‚æœæƒ³å°è¯•ä¸€ä¸‹çš„è¯ï¼Œå¯ä»¥ä¸‹è½½æˆ–è€… clone Forgeï¼Œåœ¨ Xcode 8.3 ä»¥ä¸Šç‰ˆæœ¬ä¸­æ‰“å¼€ **Forge.xcworkspace**ï¼Œåœ¨ iPhone 6 ä»¥ä¸Šè®¾å¤‡ä¸Šè¿è¡Œ **YOLO**ã€‚

æœ€ç®€å•çš„æµ‹è¯•æ–¹æ³•æ˜¯å°†ä½ çš„ iPhone å¯¹å‡†æŸä¸ª [YouTube è§†é¢‘](https://www.youtube.com/watch?v=e_WBuBqS9h8)ï¼š

![](http://machinethink.net/images/yolo/App.png)

**YOLO.swift** ä¸­æœ‰ä¸€äº›æœ‰è¶£çš„ä»£ç ã€‚é¦–å…ˆï¼Œè¿™é‡Œåˆ›å»ºäº†å·ç§¯ç½‘ç»œï¼š

```
let leaky = MPSCNNNeuronReLU(device: device, a: 0.1)

let input = Input()

let output = input
         --> Resize(width: 416, height: 416)
         --> Convolution(kernel: (3, 3), channels: 16, padding: true, activation: leaky, name: "conv1")
         --> MaxPooling(kernel: (2, 2), stride: (2, 2))
         --> Convolution(kernel: (3, 3), channels: 32, padding: true, activation: leaky, name: "conv2")
         --> MaxPooling(kernel: (2, 2), stride: (2, 2))
         --> ...and so on...
```

æ‘„åƒå¤´çš„è¾“å…¥å›¾åƒè¢«è°ƒæ•´ä¸º 416Ã—416 åƒç´ å¤§å°ï¼Œæ¥ç€è¢«è¾“å…¥åˆ°å·ç§¯å±‚å’Œæ± åŒ–å±‚ã€‚è¿™å’Œå…¶ä»–å·ç§¯ç¥ç»ç½‘ç»œçš„æ“ä½œæ˜¯éå¸¸ç±»ä¼¼çš„ã€‚

çœŸæ­£æœ‰æ„æ€çš„æ˜¯å¯¹è¾“å‡ºçš„æ“ä½œã€‚å›æƒ³ä¸€ä¸‹ï¼Œæˆ‘ä»¬çš„è¾“å‡ºæ˜¯ä¸€ä¸ª 13Ã—13Ã—125 çš„å¼ é‡ï¼šå›¾åƒä¸­æ¯ä¸ªç½‘æ ¼å•å…ƒæœ‰ 125 ä¸ªé€šé“ã€‚è¿™ 125 ä¸ªæ•°å­—åŒ…å«äº†æ£€æµ‹æ¡†çš„æ•°æ®ï¼Œä»¥åŠåˆ†ç±»é¢„æµ‹çš„æ•°æ®ã€‚æˆ‘ä»¬éœ€è¦å°†è¿™äº›æ•°æ®é€šè¿‡æŸäº›æ–¹æ³•è¿›è¡Œæ•´ç†ã€‚è¿™äº›æ˜¯é€šè¿‡ `fetchResult()` å®ç°çš„ã€‚

> æ³¨æ„ï¼šfetchResult() å‡½æ•°åœ¨ CPU ä¸­è¿è¡Œï¼Œè€Œé GPUã€‚è¿™ç§å®ç°æ–¹å¼æ¯”è¾ƒç®€å•ã€‚æœ‰äººè¯´ GPU çš„å¹¶è¡Œæ€§ä¼šå¯¹åµŒå¥—å¾ªç¯çš„è¿è¡Œæ¯”è¾ƒæœ‰åˆ©ã€‚ä¹Ÿè®¸æˆ‘åœ¨å°†æ¥ä¼šé‡æ–°å†™ä¸€ä¸ª GPU çš„ç‰ˆæœ¬ã€‚
> 

ä»¥ä¸‹æ˜¯ `fetchResult()` çš„å·¥ä½œåŸç†ï¼š

```
public func fetchResult(inflightIndex: Int) -> NeuralNetworkResult<Prediction> {
  let featuresImage = model.outputImage(inflightIndex: inflightIndex)
  let features = featuresImage.toFloatArray()
```

å·ç§¯ç½‘ç»œçš„è¾“å‡ºæ˜¯ä¸€ä¸ª `MPSImage` æ ¼å¼çš„æ•°æ®ã€‚æˆ‘ä»¬é¦–å…ˆå°†å…¶è½¬æ¢æˆä¸€ä¸ª `Float` çš„æ•°ç»„ï¼Œå³ `features`ï¼Œä»¥ä¾¿å¤„ç†ã€‚

`fetchResult()` çš„ä¸»ä½“éƒ¨åˆ†æ˜¯ä¸€ä¸ªå¤§çš„åµŒå¥—å¾ªç¯ã€‚å®ƒå¯¹æ‰€æœ‰çš„ç½‘æ ¼å•å…ƒä»¥åŠæ¯ä¸ªç½‘æ ¼å•å…ƒçš„ 5 ä¸ªé¢„æµ‹ç»“æœè¿›è¡Œéå†ï¼š

```
  for cy in 0..<13 {
    for cx in 0..<13 {
      for b in 0..<5 {
         . . .
      }
    }
  }
```

åœ¨æ¯ä¸ªå¾ªç¯ä¸­æˆ‘ä»¬å¯¹ç½‘æ ¼å•å…ƒ `(cy, cx)` è®¡ç®—å‡ºå…¶æ£€æµ‹æ¡† `b`ã€‚

é¦–å…ˆï¼Œæˆ‘ä»¬ä» `features` æ•°ç»„ä¸­è¯»å–å‡ºæ£€æµ‹æ¡†çš„ xï¼Œyï¼Œå®½ï¼Œé«˜ï¼Œä»¥åŠç½®ä¿¡åº¦ï¼š

```
let channel = b*(numClasses + 5)
let tx = features[offset(channel, cx, cy)]
let ty = features[offset(channel + 1, cx, cy)]
let tw = features[offset(channel + 2, cx, cy)]
let th = features[offset(channel + 3, cx, cy)]
let tc = features[offset(channel + 4, cx, cy)]
```

`offset()` å‡½æ•°çš„ä½œç”¨æ˜¯å¸®åŠ©åœ¨æ•°ç»„ä¸­å¯»æ‰¾è¯»å–æ•°æ®çš„åˆé€‚ä½ç½®ã€‚Metal å°†å…¶æ•°æ®ä»¥æ¯ 4 ä¸ªé€šé“ä¸ºä¸€ç»„è¿›è¡Œå­˜å‚¨ï¼Œè¿™æ„å‘³ç€è¿™ 125 ä¸ªé€šé“çš„æ•°æ®å¹¶ä¸æ˜¯è¿ç»­å­˜å‚¨çš„ï¼Œè€Œæ˜¯åˆ†æ•£çš„ã€‚ï¼ˆè¯·æŸ¥é˜…ä»£ç ä»¥è·å¾—æ›´è¯¦å°½çš„è§£é‡Šï¼‰

æˆ‘ä»¬ä»ç„¶éœ€è¦å¯¹è¿™ 5 ä¸ªæ•°æ® `tx`ï¼Œ`ty`ï¼Œ`tw`ï¼Œ`th`ï¼Œ`tc` è¿›è¡Œå¤„ç†ï¼Œå› ä¸ºå®ƒä»¬çš„æ ¼å¼æœ‰ä¸€ç‚¹å¥‡æ€ªã€‚å¦‚æœä½ å¥½å¥‡è¿™äº›å…¬å¼æ˜¯ä»å“ªé‡Œæ¥çš„ï¼Œå®ƒä»¬æ˜¯åœ¨ [è¿™ç¯‡æ–‡ç« ](https://arxiv.org/abs/1612.08242) ä¸­æå‡ºçš„ï¼ˆè¿™æ˜¯ç½‘ç»œè®­ç»ƒçš„å‰¯äº§ç‰©ï¼‰ã€‚

```
let x = (Float(cx) + Math.sigmoid(tx)) * 32
let y = (Float(cy) + Math.sigmoid(ty)) * 32

let w = exp(tw) * anchors[2*b    ] * 32
let h = exp(th) * anchors[2*b + 1] * 32

let confidence = Math.sigmoid(tc)
```

ç°åœ¨ï¼Œ`x` å’Œ `y` ä»£è¡¨åœ¨ 416Ã—416 å¤§å°çš„è¾“å…¥å›¾åƒä¸­ï¼Œæ£€æµ‹æ¡†çš„ä¸­å¿ƒç‚¹çš„åæ ‡ã€‚`w` å’Œ `h` æ˜¯æ£€æµ‹æ¡†çš„å®½å’Œé«˜ã€‚`tc` æ˜¯æ£€æµ‹æ¡†çš„ç½®ä¿¡åº¦ï¼Œæˆ‘ä»¬ç”¨ logistic sigmoid å‡½æ•°å°†å…¶è½¬æ¢æˆç™¾åˆ†åˆ¶çš„å½¢å¼ã€‚

æˆ‘ä»¬ç°åœ¨æœ‰äº†æ£€æµ‹æ¡†ï¼Œå¹¶ä¸”æˆ‘ä»¬çŸ¥é“ YOLO æœ‰å¤šç¡®ä¿¡å…¶ä¸­åŒ…å«äº†æŸä¸ªç›®æ ‡ã€‚ä¸‹ä¸€æ­¥ï¼Œè®©æˆ‘ä»¬çœ‹ä¸€ä¸‹åˆ†ç±»é¢„æµ‹çš„ç»“æœï¼Œçœ‹çœ‹ YOLO è®¤ä¸ºæ£€æµ‹æ¡†ä¸­çš„ç›®æ ‡æ˜¯ä»€ä¹ˆç‰©ä½“ï¼š

```
var classes = [Float](repeating: 0, count: numClasses)
for c in 0..<numClasses {
  classes[c] = features[offset(channel + 5 + c, cx, cy)]
}
classes = Math.softmax(classes)

let (detectedClass, bestClassScore) = classes.argmax()
```

å›æƒ³ä¸€ä¸‹ï¼Œ`features` æ•°ç»„ä¸­çš„ 20 ä¸ªé€šé“çš„æ•°æ®åŒ…å«äº†è¯¥æ£€æµ‹æ¡†çš„åˆ†ç±»æ£€æµ‹ç»“æœã€‚æˆ‘ä»¬å°†è¿™äº›è¯»å–åˆ°ä¸€ä¸ªæ–°çš„ `classes` æ•°ç»„ä¸­ã€‚åƒåˆ†ç±»å™¨çš„ä¸€èˆ¬åšæ³•ä¸€æ ·ï¼Œæˆ‘ä»¬é‡‡ç”¨ softmax å‡½æ•°æ¥å°†æ•°ç»„è½¬æ¢æˆä¸€ä¸ªæ¦‚ç‡åˆ†å¸ƒã€‚ç„¶åï¼Œæˆ‘ä»¬æŒ‘é€‰åˆ†æ•°æœ€é«˜çš„åˆ†ç±»ä½œä¸ºç»“æœã€‚

ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥å¯¹æ£€æµ‹æ¡†è®¡ç®—æœ€ç»ˆå¾—åˆ†äº† â€”â€” ä¾‹å¦‚ï¼Œâ€œæˆ‘æœ‰ 85% çš„ç¡®ä¿¡åº¦ç›¸ä¿¡è¿™ä¸ªæ£€æµ‹æ¡†åŒ…å«äº†ä¸€åªç‹—â€ã€‚ä¸€å…±ä¼šæœ‰ 845 ä¸ªæ£€æµ‹æ¡†ï¼Œè€Œæˆ‘ä»¬åªæƒ³ä¿ç•™æœ€ç»ˆå¾—åˆ†è¶…è¿‡æŸä¸€é˜ˆå€¼çš„é‚£äº›ã€‚

```
let confidenceInClass = bestClassScore * confidence
if confidenceInClass > 0.3 {
  let rect = CGRect(x: CGFloat(x - w/2), y: CGFloat(y - h/2),
                    width: CGFloat(w), height: CGFloat(h))

  let prediction = Prediction(classIndex: detectedClass,
                              score: confidenceInClass,
                              rect: rect)
  predictions.append(prediction)
}
```

å¯¹æ‰€æœ‰ç½‘æ ¼å•å…ƒé‡å¤ä¸Šè¿°ä»£ç ã€‚å½“å¾ªç¯ç»“æŸåï¼Œæˆ‘ä»¬å°±æœ‰äº†ä¸€ä¸ª `predictions` æ•°ç»„ï¼Œä¸€èˆ¬æ¥è¯´ï¼Œå…¶ä¸­ä¼šåŒ…å« 10 åˆ° 20 ä¸ªé¢„æµ‹ç»“æœã€‚

æˆ‘ä»¬å·²ç»è¿‡æ»¤æ‰äº†é‚£äº›æœ€ç»ˆå¾—åˆ†éå¸¸ä½çš„æ£€æµ‹æ¡†ï¼Œä½†å‰©ä¸‹çš„æ£€æµ‹æ¡†ä¸­ï¼Œä»ç„¶å¯èƒ½ä¼šå­˜åœ¨ç›¸äº’é‡å ç‰¹åˆ«ä¸¥é‡çš„æƒ…å†µã€‚å› æ­¤ï¼Œæˆ‘ä»¬åœ¨ `fetchResult()` ä¸­åšçš„æœ€åä¸€ä»¶äº‹å°±æ˜¯ç”¨ä¸€ç§ç§°ä¸º*éæå¤§å€¼æŠ‘åˆ¶*çš„æ–¹æ³•æ¥å‡å°‘è¿™ç§é‡å¤çš„æ£€æµ‹æ¡†ã€‚

```
  var result = NeuralNetworkResult<Prediction>()
  result.predictions = nonMaxSuppression(boxes: predictions,
                                         limit: 10, threshold: 0.5)
  return result
}
```

`nonMaxSuppression()` å‡½æ•°æ‰€ä½¿ç”¨çš„ç®—æ³•å¾ˆç®€å•ï¼š

1. ä»æœ€ç»ˆå¾—åˆ†æœ€é«˜çš„é‚£ä¸ªæ£€æµ‹æ¡†å¼€å§‹ã€‚
2. å°†å…¶ä»–ä¸è¯¥æ£€æµ‹æ¡†é‡å ç‡è¶…è¿‡ä¸€å®šé˜ˆå€¼ï¼ˆæ¯”å¦‚è¶…è¿‡ 50%ï¼‰çš„æ£€æµ‹æ¡†ç§»é™¤ã€‚
3. è¿”å›ç¬¬ä¸€æ­¥ï¼Œé‡å¤ç›´åˆ°éå†å®Œæ‰€æœ‰çš„æ£€æµ‹æ¡†ã€‚

è¯¥ç®—æ³•ç§»é™¤äº†ä¸æ›´é«˜å¾—åˆ†çš„æ£€æµ‹æ¡†æœ‰å¤ªå¤šé‡å çš„å…¶ä»–æ£€æµ‹æ¡†ï¼Œåªä¿ç•™äº†æœ€å¥½çš„é‚£äº›ã€‚

ä»¥ä¸Šå°±æ˜¯æ‰€æœ‰çš„è¿‡ç¨‹äº†ï¼šä¸€ä¸ªå¸¸è§„çš„å·ç§¯ç½‘ç»œï¼Œä»¥åŠåç»­å¯¹ç»“æœçš„ä¸€äº›å¤„ç†ã€‚

### è¿è¡Œæ•ˆæœå¦‚ä½•ï¼Ÿ

[YOLO å®˜æ–¹ç½‘ç«™](https://pjreddie.com/darknet/yolo/)å®£ç§°ç²¾ç®€ç‰ˆ YOLO æœ€å¿«æ¯ç§’å¯å¤„ç† 200 å¸§å›¾åƒã€‚ä½†é‚£æ˜¯åœ¨æ€§èƒ½ä¼˜ç§€çš„ç¬”è®°æœ¬ä¸Šçš„è¿è¡Œç»“æœï¼Œè€Œä¸æ˜¯åœ¨ç§»åŠ¨è®¾å¤‡ä¸Šã€‚é‚£ä¹ˆï¼Œå®ƒåœ¨ iPhone ä¸Šèƒ½å¤Ÿè¿è¡Œå¤šå¿«å‘¢ï¼Ÿ

åœ¨æˆ‘çš„ iPhone 6s ä¸Šï¼Œå®ƒå¤„ç†ä¸€å¹…å›¾åƒå¤§çº¦éœ€è¦ 0.15 ç§’ã€‚é‚£ä¹Ÿåªæœ‰ 6 FPSï¼Œå‡ ä¹ä¸èƒ½ç§°ä¹‹ä¸ºå®æ—¶ã€‚å¦‚æœä½ å°†æ‰‹æœºå¯¹å‡†ä¸€è¾†å¼€è¿‡çš„æ±½è½¦ï¼Œä½ ä¼šçœ‹åˆ°ä¸€ä¸ªæ£€æµ‹æ¡†æ‹–åœ¨æ±½è½¦åé¢ä¸€äº›ã€‚å°½ç®¡å¦‚æ­¤ï¼Œå®ƒèƒ½å¤Ÿç”Ÿæ•ˆå·²ç»ä½¿æˆ‘å°è±¡æ·±åˆ»äº†ã€‚ğŸ˜

> æ³¨æ„ï¼šæ­£å¦‚ä¸Šæ–‡è§£é‡Šï¼Œæ£€æµ‹æ¡†çš„å¤„ç†æ˜¯åœ¨ CPU ä¸Šè¿›è¡Œï¼Œè€Œä¸æ˜¯ GPUã€‚å¦‚æœ YOLO å®Œå…¨è¿è¡Œåœ¨ GPU ä¸Šï¼Œä¼šå˜å¾—æ›´å¿«å—ï¼Ÿä¹Ÿè®¸ä¼šï¼Œä½† CPU ä»£ç è¿è¡Œæ—¶é—´åªæœ‰ 0.03 ç§’ï¼Œå  20% çš„è¿è¡Œæ—¶é—´ã€‚å°†å…¶ä¸­ä¸€éƒ¨åˆ†å·¥ä½œäº¤ç»™ GPU åšå½“ç„¶æ˜¯å¯è¡Œçš„ï¼Œä½†è€ƒè™‘åˆ°å·ç§¯å±‚çš„è®¡ç®—ä»ç„¶å æ®äº† 80% çš„æ—¶é—´ï¼Œæˆ‘ä¸ç¡®å®šæ˜¯å¦å€¼å¾—è¿™æ ·åšã€‚
> 

æˆ‘è®¤ä¸ºå¯¼è‡´å˜æ…¢çš„ä¸»è¦åŸå› åœ¨äºè¾“å‡ºé€šé“ä¸º 512 å’Œ 1024 å·ç§¯å±‚ã€‚ç»è¿‡å®éªŒï¼Œ`MPSCNNConvolution` åœ¨é€šé“è¾ƒå¤šçš„å°å›¾ç‰‡ä¸Šçš„è¡¨ç°æ¯”åœ¨é€šé“è¾ƒå°‘çš„å¤§å›¾ç‰‡ä¸Šä¼šæ›´å·®ã€‚

å¦ä¸€ä»¶æˆ‘æ¯”è¾ƒæ„Ÿå…´è¶£çš„äº‹æƒ…æ˜¯é‡‡ç”¨å¦ä¸€ç§ä¸åŒçš„ç½‘ç»œç»“æ„ï¼Œä¾‹å¦‚ SqueezeNetï¼Œå¯¹å…¶é‡æ–°è¿›è¡Œè®­ç»ƒï¼Œä»¥åœ¨æœ€åä¸€å±‚è¿›è¡Œæ£€æµ‹æ¡†çš„é¢„æµ‹ã€‚æ¢å¥è¯è¯´ï¼Œé‡‡ç”¨ YOLO çš„æ€æƒ³ï¼Œå¹¶å°†å…¶åº”ç”¨åœ¨ä¸€ä¸ªæ›´å°æ›´å¿«çš„ç½‘ç»œä¸Šã€‚è¿™æ ·ä»¥ç²¾ç¡®åº¦çš„æŸå¤±æ¢æ¥é€Ÿåº¦ä¸Šçš„æå‡æ˜¯å¦å€¼å¾—å‘¢ï¼Ÿ

> æ³¨æ„ï¼šé¡ºä¾¿è¯´ä¸€å¥ï¼Œæœ€è¿‘çš„ [Caffe2](http://caffe2.ai/) æ¡†æ¶ä¹Ÿæ˜¯é€šè¿‡ Metal çš„æ”¯æŒï¼Œè¿è¡Œåœ¨ iOS è®¾å¤‡ä¸Šã€‚[Caffe2-iOS project](https://github.com/KleinYuan/Caffe2-iOS) æ˜¯ä¸€ä¸ªé’ˆå¯¹ YOLO çš„ç²¾ç®€ç‰ˆæœ¬ã€‚çœ‹èµ·æ¥å®ƒè¿è¡Œå¾—ä¼šæ¯”çº¯ Metal ç‰ˆç¨æ…¢ï¼Œå¤§çº¦ 0.17 ç§’/å¸§ã€‚
> 

### åè®°

æƒ³è¦äº†è§£æ›´å¤š YOLO ç›¸å…³çš„çŸ¥è¯†ï¼Œå¯ä»¥æŸ¥çœ‹ YOLO ä½œè€…çš„ä»¥ä¸‹è®ºæ–‡ï¼š

- [You Only Look Once: Unified, Real-Time Object Detection](https://arxiv.org/abs/1506.02640) by Joseph Redmon, Santosh Divvala, Ross Girshick, Ali Farhadi (2015)
- [YOLO9000: Better, Faster, Stronger](https://arxiv.org/abs/1612.08242) by Joseph Redmon and Ali Farhadi (2016)

æˆ‘çš„å®ç°ä¸€éƒ¨åˆ†åŸºäº TensorFlow Android demo [TF Detect](https://github.com/tensorflow/tensorflow/tree/master/tensorflow/examples/android)ï¼ŒAllan Zelener çš„ [YAD2K](https://github.com/allanzelener/YAD2K/)ï¼Œä»¥åŠ [Darknet æºä»£ç ](https://github.com/pjreddie/darknet)ã€‚