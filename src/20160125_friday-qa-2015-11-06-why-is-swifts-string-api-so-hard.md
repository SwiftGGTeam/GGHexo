title: "Friday Q&A 2015-11-06ï¼šä¸ºä»€ä¹ˆ Swift ä¸­çš„ String API å¦‚æ­¤éš¾ç”¨ï¼Ÿ"
date: 2016-01-25
tags: [Mike Ash]
categories: [Swift è¿›é˜¶]
permalink: friday-qa-2015-11-06-why-is-swifts-string-api-so-hard
---

åŸæ–‡é“¾æ¥=https://www.mikeash.com/pyblog/friday-qa-2015-11-06-why-is-swifts-string-api-so-hard.html
ä½œè€…=Mike Ash
åŸæ–‡æ—¥æœŸ=2015-11-06
è¯‘è€…=Cee
æ ¡å¯¹=numbbbbb
å®šç¨¿=numbbbbb

<!--æ­¤å¤„å¼€å§‹æ­£æ–‡-->

> è¯‘è€…æ³¨ï¼šå¯ä»¥ç»“åˆ WWDC 2015 Session 227 - What's New in Internationalization ä¸€èµ·å­¦ä¹ 

æ¬¢è¿æ¥åˆ°æœ¬æœŸå› ä¿®æ”¹äº†å¾ˆå¤šæ¬¡ç¨¿è€Œæ¨è¿Ÿå‘å¸ƒçš„å‘¨äº”é—®ç­”ã€‚æˆ‘å‘ç°å¾ˆå¤šäººåœ¨ä½¿ç”¨ Swift æ—¶ï¼Œéƒ½ä¼šæŠ±æ€¨ `String` API å¾ˆéš¾ç”¨ã€‚å®ƒå¾ˆéš¾å­¦ä¹ å¹¶ä¸”è®¾è®¡å¾—æ™¦æ¶©éš¾æ‡‚ï¼Œå¤§å¤šæ•°äººå¸Œæœ›å®ƒèƒ½é‡‡ç”¨å…¶ä»–è¯­è¨€çš„å­—ç¬¦ä¸²ï¼ˆStringï¼‰ API è®¾è®¡é£æ ¼ã€‚ä»Šå¤©æˆ‘å°±è¦æ¥è®²ä¸€ä¸‹ä¸ºä»€ä¹ˆ Swift ä¸­çš„ `String` API ä¼šè¢«è®¾è®¡æˆç°åœ¨è¿™æ ·ï¼ˆæœ€èµ·ç è¦è§£é‡Šæ¸…æ¥šæˆ‘çš„çœ‹æ³•ï¼‰ï¼Œä»¥åŠä¸ºä»€ä¹ˆæˆ‘æœ€ç»ˆä¼šè®¤ä¸ºï¼Œå°±å…¶åŸºç¡€è®¾è®¡è€Œè¨€ Swift ä¸­çš„ `String` API æ˜¯å­—ç¬¦ä¸² API ä¸­è®¾è®¡å¾—æœ€å¥½çš„ã€‚

<!-- more -->
### ä»€ä¹ˆæ˜¯å­—ç¬¦ä¸²ï¼Ÿ

åœ¨æˆ‘ä»¬è®¨è®ºè¿™ç‚¹ä¹‹å‰ï¼Œé¦–å…ˆéœ€è¦å»ºç«‹ä¸€ä¸ªåŸºæœ¬çš„æ¦‚å¿µã€‚æˆ‘ä»¬æ€»æ˜¯æŠŠå­—ç¬¦ä¸²æƒ³å¾—å¾ˆè‚¤æµ…ï¼Œå¾ˆå°‘æœ‰äººèƒ½å¤Ÿæ·±å…¥æ€è€ƒå®ƒçš„æœ¬è´¨ã€‚æ·±æ€ç†Ÿè™‘æ‰èƒ½æœ‰åŠ©äºæˆ‘ä»¬ç†è§£æ¥ä¸‹æ¥çš„å†…å®¹ã€‚

ä»æ¦‚å¿µä¸Šæ¥è¯´ï¼Œä»€ä¹ˆ*æ˜¯*å­—ç¬¦ä¸²å‘¢ï¼Ÿä»è¡¨é¢ä¸Šçœ‹ï¼Œå­—ç¬¦ä¸²å°±æ˜¯ä¸€æ®µæ–‡æœ¬ã€‚`"Hello, World"` æ˜¯å­—ç¬¦ä¸²ï¼›`"/Users/mikeash"` å’Œ `"Robert'); DROP TABLE Students;--"` ä¹Ÿæ˜¯å­—ç¬¦ä¸²ã€‚

ï¼ˆé¡ºé“è®²ä¸€ä¸‹ï¼Œæˆ‘è®¤ä¸ºä¸åº”è¯¥æŠŠè¿™äº›ä¸åŒçš„æ–‡æœ¬è¡¨è¿°æ¦‚å¿µçœ‹ä½œæ˜¯åŒæ ·çš„å­—ç¬¦ä¸²ç±»å‹ã€‚äººç±»å¯è¯»çš„æ–‡æœ¬ã€æ–‡ä»¶è·¯å¾„ã€SQL æŸ¥è¯¢è¯­å¥ï¼Œä»¥åŠå…¶ä»–æ‰€æœ‰åœ¨æ¦‚å¿µä¸Šè®²å¹¶ä¸ç›¸åŒçš„ä¸œè¥¿ï¼Œåœ¨è¯­è¨€è¡¨ç¤ºå±‚é¢ä¸Šéƒ½åº”è¯¥è¢«è¡¨ç¤ºæˆä¸åŒçš„ç±»å‹ã€‚æˆ‘è§‰å¾—è¿™äº›æ¦‚å¿µä¸Šä¸åŒçš„å­—ç¬¦ä¸²åº”å½“æœ‰ä¸åŒçš„ç±»å‹ï¼Œè¿™ä¹Ÿèƒ½å¤§å¹…å‡å°‘ bug æ•°é‡ã€‚å°½ç®¡æˆ‘å¹¶æ²¡æœ‰å‘ç°æœ‰å“ªä¸ªè¯­è¨€æˆ–è€…æ ‡å‡†åº“åšåˆ°äº†è¿™ç‚¹ã€‚ï¼‰

é‚£ä¹ˆåœ¨åº•å±‚ï¼Œè¿™äº›å¸¸è§çš„ã€Œæ–‡æœ¬ã€æ¦‚å¿µåˆæ˜¯æ€ä¹ˆè¢«è¡¨ç¤ºçš„å‘¢ï¼Ÿå””ï¼Œå¾—çœ‹æƒ…å†µã€‚æœ‰å¾ˆå¤šä¸åŒçš„è§£å†³æ–¹æ³•ã€‚

åœ¨å¾ˆå¤šè¯­è¨€ä¸­ï¼Œå­—ç¬¦ä¸²æ˜¯ç”¨äºå­˜æ”¾å­—èŠ‚ï¼ˆbytesï¼‰çš„æ•°ç»„ï¼ˆarrayï¼‰ã€‚ç¨‹åºæ‰€è¦åšçš„å°±æ˜¯ä¸ºè¿™äº›å­—èŠ‚èµ‹å€¼ã€‚è¿™ç§å­—ç¬¦ä¸²çš„è¡¨ç¤ºæ–¹æ³•åœ¨ C++ ä¸­æ˜¯ `std::string` ç±»å‹ï¼ŒPython 2ã€Go å’Œå…¶ä»–è¯­è¨€ä¹Ÿæ˜¯è¿™æ ·ã€‚

C è¯­è¨€å¯¹äºå­—ç¬¦ä¸²çš„è¡¨ç¤ºå°±æ¯”è¾ƒå¤æ€ªå’Œç‰¹æ®Šã€‚åœ¨ C è¯­è¨€ä¸­ï¼Œå­—ç¬¦ä¸²æ˜¯æŒ‡å‘ä¸€ä¸²éé›¶å­—èŠ‚åºåˆ—ï¼ˆsequence of non-zero bytesï¼‰çš„æŒ‡é’ˆï¼Œä»¥é›¶å­—èŠ‚ä½è¡¨ç¤ºå­—ç¬¦ä¸²çš„ç»“æŸã€‚åŸºæœ¬çš„ä½¿å…¶å®å’Œæ•°ç»„ä¸€æ ·ï¼Œä½†æ˜¯ C è¯­è¨€ä¸­çš„å­—ç¬¦ä¸²ä¸èƒ½åŒ…å«é›¶å­—èŠ‚ä½ï¼Œå¹¶ä¸”è¯¸å¦‚æŸ¥è¯¢å­—ç¬¦ä¸²é•¿åº¦è¿™æ ·çš„æ“ä½œéœ€è¦æ‰«æå†…å­˜ã€‚

å¾ˆå¤šæ–°è¯­è¨€æŠŠå­—ç¬¦ä¸²å®šä¹‰æˆäº†ä¸€ä¸² UCS-2 æˆ–è€… UTF-16 ç å…ƒï¼ˆcode unitï¼‰çš„é›†åˆã€‚Javaã€C# è¿˜æœ‰ JavaScript æ˜¯å…¶ä¸­çš„ä»£è¡¨ã€‚åŒæ ·ï¼Œåœ¨ Objective-C ä¸­ä¹Ÿä½¿ç”¨äº† Cocoa å’Œ `NSString`ã€‚è¿™å¯èƒ½æ˜¯ä¸€ä¸ªå†å²é—ç•™é—®é¢˜ã€‚Unicode åœ¨ 1991 å¹´è¢«æå‡ºæ—¶ï¼ˆè¯‘è€…æ³¨ï¼š1991 å¹´ 10 æœˆå‘å¸ƒ Unicode 1.0.0ï¼‰ï¼Œå½“æ—¶çš„ç³»ç»Ÿéƒ½æ˜¯ 16 ä½ã€‚å¾ˆå¤šæµè¡Œçš„ç¼–ç¨‹è¯­è¨€åœ¨é‚£ä¸ªæ—¶ä»£è¢«è®¾è®¡å‡ºæ¥ï¼Œå¹¶ä¸”å°† Unicode ä½œä¸ºå­—ç¬¦ä¸²çš„æ„æˆåŸºç¡€ã€‚åœ¨ 1996 å¹´ï¼ŒUnicode åœ¨ 16 ä½ç³»ç»Ÿä¸Šç»å†äº†çˆ†å‘æ€§çš„å¢é•¿ï¼ˆè¯‘è€…æ³¨ï¼š1996 å¹´ 7 æœˆå‘å¸ƒäº† Unicode 2.0ï¼Œå­—åº“ä» 7161 ä¸ªå­—å…ƒå˜æˆäº† 38950 ä¸ªï¼‰ï¼Œè¿™äº›è¯­è¨€å†è¦æ”¹å˜å­—ç¬¦ä¸²çš„ç¼–ç æ–¹å¼å·²ä¸ºæ—¶å·²æ™šã€‚è¿™æ—¶ï¼Œç”±äº UTF-16 çš„ç¼–ç æ–¹å¼èƒ½å¤Ÿå°†æ›´å¤§çš„æ•°å­—ç¼–ç ä¸ºä¸€ç»„ 16 ä½ç å…ƒçš„é›†åˆï¼Œå› æ­¤å°†å­—ç¬¦ä¸²è§†ä¸º 16 ä½ç å…ƒåºåˆ—çš„åŸºæœ¬æƒ³æ³•å°±è¿™æ ·å»¶ç»­äº†ä¸‹æ¥ã€‚

è¿™ç§æƒ³æ³•çš„ä¸€ä¸ªå˜ä½“å°±æ˜¯å°†å­—ç¬¦ä¸²å®šä¹‰æˆ UTF-8 ç å…ƒåºåˆ—ï¼Œå…¶ä¸­ç»„æˆçš„ç å…ƒæ˜¯ 8 ä½çš„ã€‚æ€»ä½“ä¸Šæ¥è¯´å’Œ UTF-16 çš„è¡¨ç¤ºæ–¹æ³•å¾ˆæ¥è¿‘ï¼Œä½†æ˜¯å¯¹äº ASCII å­—ç¬¦ä¸²æ¥è¯´ï¼Œèƒ½å¤Ÿæœ‰æ›´åŠ ç´§å‡‘çš„è¡¨ç¤ºç©ºé—´ï¼Œè€Œä¸”é¿å…äº†åœ¨ä¼ é€’å­—ç¬¦ä¸²è¿›å…¥å‡½æ•°æ—¶ï¼Œç”±äºè¿™äº›å‡½æ•°åªæ¥å— C è¯­è¨€é£æ ¼ç±»å‹ï¼ˆä¹Ÿå°±æ˜¯ UTF-8 å­—ç¬¦ä¸²ï¼‰è€Œå¯¼è‡´çš„è½¬æ¢ã€‚

ä¹Ÿæœ‰äº›è¯­è¨€å°†å­—ç¬¦ä¸²è¡¨ç¤ºä¸º Unicode ç ä½ï¼ˆcode pointï¼‰æŒ‡å‘çš„ä¸€æ®µå­—ç¬¦åºåˆ—ã€‚Python 3 ä¸­å°±æ˜¯è¿™ä¹ˆå®ç°çš„ï¼Œåœ¨å¾ˆå¤š C è¯­è¨€å®ç°ä¸­ä¹Ÿæä¾›äº†å†…ç½®çš„ `wchar_t` ç±»å‹ã€‚

ç®€çŸ­æ¦‚æ‹¬ä¸€ä¸‹ï¼Œä¸€ä¸ªå­—ç¬¦ä¸²é€šå¸¸æƒ…å†µä¸‹ä¼šè¢«å½“åšæŸäº›ç‰¹å®š*å­—ç¬¦ï¼ˆcharacterï¼‰*çš„åºåˆ—ï¼Œå…¶ä¸­å­—ç¬¦é€šå¸¸æ˜¯ä¸€ä¸ªå­—èŠ‚ï¼Œæˆ–è€…æ˜¯ä¸€ä¸ª UTF-16 ç å…ƒï¼Œåˆæˆ–è€…æ˜¯ä¸€ä¸ª Unicode ç ä½ã€‚

### é—®é¢˜

å°†å­—ç¬¦ä¸²è¡¨ç¤ºæˆä¸€æ®µè¿ç»­ã€Œå­—ç¬¦ã€çš„åºåˆ—çš„ç¡®å¾ˆæ–¹ä¾¿ã€‚ä½ å¯ä»¥æŠŠå­—ç¬¦ä¸²çœ‹ä½œæ˜¯æ•°ç»„ï¼ˆarrayï¼‰ï¼ˆé€šå¸¸æƒ…å†µä¸‹å°±*æ˜¯*ä¸ªæ•°ç»„ï¼‰ï¼Œè¿™æ ·å°±å¾ˆå®¹æ˜“è·å¾—å­—ç¬¦ä¸²çš„å­ä¸²ã€ä»å­—ç¬¦ä¸²å¤´éƒ¨æˆ–è€…å°¾éƒ¨å–å‡ºéƒ¨åˆ†å…ƒç´ ã€åˆ é™¤å­—ç¬¦ä¸²çš„æŸéƒ¨åˆ†ã€è·å–å­—ç¬¦æ€»æ•°ï¼Œç­‰ç­‰ã€‚

é—®é¢˜æ˜¯æˆ‘ä»¬èº«è¾¹éå¸ƒç€ Unicodeï¼Œè€Œ Unicode ä¼šè®©äº‹æƒ…å˜å¾—å¾ˆå¤æ‚ã€‚ç®€å•çœ‹ä¸€ä¸ªå­—ç¬¦ä¸²çš„ä¾‹å­ï¼Œçœ‹ä¸€ä¸‹å®ƒæ˜¯æ€ä¹ˆå·¥ä½œçš„ï¼š

```
    aÃ©âˆğ„
```

æ¯ä¸€ä¸ª Unicode ç ä½éƒ½æœ‰ä¸€ä¸²æ•°å­—ï¼ˆå†™ä½œ U+nnnnï¼‰å’Œä¸€ä¸ªä¾›æˆ‘ä»¬çœ‹å¾—æ‡‚çš„å‘½åï¼ˆæŸç§åŸå› ä½¿ç”¨å…¨å¤§å†™çš„è‹±æ–‡å­—æ¯è¡¨ç¤ºï¼‰ï¼Œè¿™æ ·æˆ‘ä»¬æ›´å®¹æ˜“è®¨è®ºå•ä¸ªå­—ç¬¦æ‰€è¡¨ç¤ºçš„å†…å®¹ã€‚å¯¹äºä¸Šé¢è¿™ä¸ªç‰¹å®šçš„å­—ç¬¦ä¸²ï¼Œå®ƒåŒ…æ‹¬äº†ï¼š

+ U+0061 LATIN SMALL LETTER A
+ U+0065 LATIN SMALL LETTER E
+ U+0301 COMBINING ACUTE ACCENT
+ U+221E INFINITY
+ U+1D11E MUSICAL SYMBOL G CLEF

è®©æˆ‘ä»¬ä»å­—ç¬¦ä¸²çš„ä¸­é—´ç§»é™¤ä¸€ä¸ªã€Œå­—ç¬¦ã€ã€‚å¯¹äºè¿™ä¸ªã€Œå­—ç¬¦ã€ï¼Œæˆ‘ä»¬å°è¯•ç”¨ UTF-8ã€UTF-16 å’Œ Unicode ä¸‰ç§ä¸åŒçš„å­—ç¬¦ç¼–ç æ–¹å¼æ¥è®²è§£ã€‚

é¦–å…ˆå°†è¿™ä¸ªã€Œå­—ç¬¦ã€çœ‹ä½œæ˜¯ä¸€ä¸ª UTF-8 å­—ç¬¦å•å…ƒã€‚è¿™ä¸ªå­—ç¬¦ä¸²åœ¨ UTF-8 ä¸‹çœ‹ä¸Šå»é•¿è¿™æ ·ï¼š

```
    61 65 cc 81 e2 88 9e f0 9d 84 9e
    -- -- ----- -------- -----------
    a  e    Â´      âˆ          ğ„
```

æˆ‘ä»¬æ¥ç§»é™¤ç¬¬ 3 ä¸ªã€Œå­—ç¬¦ã€ï¼Œå³ç¬¬ä¸‰ä¸ªå­—èŠ‚ï¼ˆccï¼‰ã€‚ç»“æœæ˜¯ï¼š

```
    61 65 81 e2 88 9e f0 9d 84 9e
```

è¿™ä¸ªå­—ç¬¦ä¸²å·²ç»ä¸å†æ˜¯ä¸ªåˆæ³•çš„ UTF-8 å­—ç¬¦ä¸²ã€‚UTF-8 çš„å­—ç¬¦ç¼–ç æœ‰ä¸‰ç±»ã€‚å¯¹äºé‚£äº› `0xxxxxxx` è¡¨ç¤ºçš„ï¼Œå³ç”± 0 å¼€å¤´çš„ï¼Œä¼šè¢«è¡¨ç¤ºä¸º ASCII å­—ç¬¦ï¼Œå•ç‹¬å½’ä¸ºç¬¬ä¸€ç±»ã€‚é‚£äº›çœ‹ä¸Šå»å½¢å¦‚ `11xxxxxx` çš„ï¼Œè¡¨ç¤ºä¸€ä¸ªå¤šä½åºåˆ—ï¼Œé•¿åº¦ç”±ç¬¬ä¸€ä¸ª 0 çš„ä½ç½®å†³å®šã€‚ç¬¬ä¸‰ç±»è¡¨ç¤ºæˆ `10xxxxxx`ï¼Œè¯´æ˜ä¸€ä¸ªå¤šä½åºåˆ—çš„å‰©ä½™éƒ¨åˆ†ã€‚`cc`ï¼ˆè¯‘è€…æ³¨ï¼šå³ `11001100`ï¼Œåˆ’åˆ†åœ¨ç¬¬äºŒç±»ã€‚å…¶ä¸­ç¬¬ä¸€ä¸ª 0 å‡ºç°åœ¨ä» 0 å¼€å§‹è®¡æ•°çš„ç¬¬ 2 ä½ï¼Œæ•…æ•´ä¸ªå¤šä½åºåˆ—ç”±ä¸¤ä¸ªå­—èŠ‚ç»„æˆï¼‰è¡¨ç¤ºäº†ä¸€ä¸ªå¤šä½åºåˆ—çš„å¼€å§‹ï¼Œé•¿åº¦æ˜¯ä¸¤ä¸ªå­—èŠ‚ï¼Œ`81`ï¼ˆè¯‘è€…æ³¨ï¼šå³ `10000001`ï¼Œåˆ’åˆ†åœ¨ç¬¬ä¸‰ç±»ï¼‰è¡¨ç¤ºäº†è¿™ä¸ªå¤šä½åºåˆ—çš„å°¾éƒ¨ã€‚å¦‚æœç§»é™¤äº† `cc`ï¼Œé‚£ä¹ˆå‰©ä¸‹çš„ `81` å°†ä¼šè¢«ç•™åœ¨å­—ç¬¦ä¸²ä¸­ã€‚æ‰€æœ‰ UTF-8 æ ¡éªŒå™¨éƒ½ä¼šæ‹’ç»è¯†åˆ«è¿™ä¸ªå­—ç¬¦ä¸²ï¼ˆè¯‘è€…æ³¨ï¼šå› ä¸º `81` å¹¶ä¸æ˜¯åˆæ³•çš„ UTF-8 å¤´éƒ¨å­—ç¬¦ï¼Œåªæœ‰ç¬¬ä¸€ç±»å’Œç¬¬äºŒç±»çš„å­—ç¬¦æ˜¯åˆæ³•çš„ï¼‰ã€‚å¦‚æœæˆ‘ä»¬ç§»é™¤äº†ä»ç¬¬ä¸‰ä½ä¹‹åçš„ä»»æ„ä¸€ä¸ªå­—ç¬¦ï¼Œè¿™ä¸ªé—®é¢˜ä¾æ—§ä¼šå‘ç”Ÿã€‚

é‚£ä¹ˆå¦‚æœæ˜¯ç¬¬äºŒä½å‘¢ï¼Ÿå¦‚æœæˆ‘ä»¬ç§»é™¤äº†è¿™ä¸ªå­—ç¬¦ï¼Œæˆ‘ä»¬ä¼šå¾—åˆ°ï¼š

```
    61 cc 81 e2 88 9e f0 9d 84 9e
    -- ----- -------- -----------
    a    Â´      âˆ          ğ„
```

çœ‹ä¸Šå»è¿™ä¾ç„¶æ˜¯ä¸ªåˆæ³•çš„ UTF-8 å­—ç¬¦ä¸²ï¼Œä½†æ˜¯ç»“æœå¹¶ä¸æ˜¯æˆ‘ä»¬æ‰€æœŸå¾…çš„é‚£æ ·ï¼š

```
    Ã¡âˆğ„
```

å¯¹äºäººç±»æ¥è¯´ï¼Œåœ¨è¿™ä¸ªå­—ç¬¦ä¸²ä¸­çš„ã€Œç¬¬äºŒä¸ªå­—ç¬¦ã€åº”è¯¥æ˜¯ã€ŒÃ©ã€ã€‚ä½†æ˜¯ç¬¬äºŒä½ä¸Šçš„å­—ç¬¦ä»…ä»…æ˜¯ä¸å¸¦è¯­è°ƒæ ‡è®°çš„ã€Œeã€ã€‚è¿™ä¸ªè¯­è°ƒæ ‡è®°è¢«çœ‹ä½œæ˜¯ä¸€ä¸ªã€Œè¿æ¥å­—ç¬¦ï¼ˆcombining characterï¼‰ã€ï¼Œè¢«å•ç‹¬æ·»åŠ åˆ°å‰é¢çš„å­—ç¬¦ä¸Šã€‚ç§»é™¤ç¬¬äºŒä¸ªå­—ç¬¦ä»…ä»…æ˜¯ç§»å»äº†ã€Œeã€ï¼Œå¯¼è‡´è¿™ä¸ªè¯­è°ƒæ ‡è®°è¿æ¥åˆ°äº†ã€Œaã€å­—ç¬¦ä¸Šã€‚

é‚£ä¹ˆå¦‚æœç§»å»é¦–ä¸ªå­—ç¬¦å‘¢ï¼Ÿæœ€ç»ˆç»“æœæ˜¯æˆ‘ä»¬æ‰€æƒ³è¦çš„é‚£æ ·ï¼š

```
    65 cc 81 e2 88 9e f0 9d 84 9e
    -- ----- -------- -----------
    e    Â´      âˆ          ğ„
```

è®©æˆ‘ä»¬å†æŠŠè¿™ä¸ªå­—ç¬¦ä¸²å½“åš UTF-16 ç¼–ç æ¥çœ‹ã€‚åœ¨ UTF-16 ç¼–ç ä¸‹ï¼Œè¿™ä¸ªå­—ç¬¦ä¸²çœ‹ä¸Šå»é•¿è¿™ä¸ªæ ·å­ï¼š

```
    0061 0065 0301 221e d834 dd1e
    ---- ---- ---- ---- ---------
     a    e    Â´    âˆ       ğ„
```

æˆ‘ä»¬å°è¯•ç€ç§»é™¤ç¬¬äºŒä¸ªã€Œå­—ç¬¦ã€ï¼š

```
    0061 0301 221e d834 dd1e
    ---- ---- ---- ---------
     a    Â´    âˆ       ğ„
```

å’Œä¸Šé¢åœ¨ UTF-8 ä¸­å‡ºç°çš„é—®é¢˜ä¸€æ ·ï¼Œåˆ é™¤äº†ã€Œeã€ï¼Œä½†æ˜¯æ²¡æœ‰åˆ é™¤è¯­è°ƒæ ‡è®°ï¼Œå¯¼è‡´è¿™ä¸ªæ ‡è®°é™„åœ¨äº†ã€Œaã€ä¸Šé¢ã€‚

é‚£ä¹ˆå¦‚æœåˆ é™¤ç¬¬äº”ä¸ªå­—ç¬¦å‘¢ï¼Ÿæˆ‘ä»¬å¾—åˆ°äº†å¦‚ä¸‹çš„åºåˆ—ï¼š

```
    0061 0065 0301 221e dd1e
```

å’Œä¸åˆæ³•çš„ UTF-8 ç¼–ç æ˜¯ç±»ä¼¼çš„é—®é¢˜ï¼Œè¿™ä¸ªåºåˆ—ä¹Ÿä¸å†æ˜¯ä¸€ä¸ªåˆæ³•çš„ UTF-16 å­—ç¬¦ä¸²ã€‚åºåˆ— `d834 dd1e` å½¢æˆäº†ä¸€ç»„ä»£ç†å¯¹ï¼ˆsurrogate pairï¼‰ï¼ŒæŒ‡ä¸¤ä¸ª 16 ä½çš„å•å…ƒç”¨äºè¡¨ç¤ºä¸€ä¸ªè¶…è¿‡ 16 ä½çš„ç ä½ï¼ˆè¯‘è€…æ³¨ï¼šå…·ä½“è®¡ç®—å‚è€ƒ [Wiki](http://www.wikiwand.com/zh/UTF-16#.E4.BB.8EU.2B10000.E5.88.B0U.2B10FFFF.E7.9A.84.E7.A0.81.E4.BD.8D)ï¼‰ã€‚è€Œè®©ä»£ç†å¯¹ä¸­çš„ä¸€éƒ¨åˆ†å•ç‹¬å‡ºç°åœ¨å­—ç¬¦ä¸²ä¸­æ˜¯éæ³•çš„ã€‚åœ¨ UTF-8 ä¸­é€šå¸¸ä¼šå‡ºé”™ï¼Œè€Œåœ¨ UTF-16 ä¸­è¿™ç§çŠ¶æ€ä¼šè¢«å¿½ç•¥ã€‚ä¾‹å¦‚ï¼ŒCocoa ä¼šå°†è¿™ä¸ªå­—ç¬¦ä¸²æ¸²æŸ“æˆè¿™æ ·ï¼š

```
    aÃ©âˆï¿½
```

ï¼ˆè¯‘è€…æ³¨ï¼šå³å¹³æ—¶å‡ºç°çš„ä¹±ç ç°è±¡ã€‚ï¼‰

é‚£ä¹ˆå¦‚æœä¸€ä¸ªå­—ç¬¦ä¸²è¢«è¡¨ç¤ºæˆä¸€ä¸² Unicode ç ä½åºåˆ—å‘¢ï¼Ÿå­—ç¬¦ä¸²çœ‹ä¸Šå»æ˜¯è¿™æ ·çš„ï¼š

```
    00061 00065 00301 0221E 1D11E
    ----- ----- ----- ----- -----
      a     e     Â´     âˆ     ğ„
```

å¯¹äºè¿™ç§è¡¨ç¤ºæ–¹å¼ï¼Œæˆ‘ä»¬å¯ä»¥ç§»é™¤ä»»æ„ä¸€ä¸ªã€Œå­—ç¬¦ã€è€Œä¸ä¼šå¯¼è‡´äº§ç”Ÿä¸€ä¸ªéæ³•çš„å­—ç¬¦ä¸²ã€‚ä½†æ˜¯è¿æ¥è¯­è°ƒæ ‡è®°çš„é—®é¢˜*ä¾ç„¶*å­˜åœ¨ã€‚ç§»é™¤ç¬¬äºŒä¸ªå­—ç¬¦å°†ä¼šæ˜¯è¿™æ ·ï¼š

```
    00061 00301 0221E 1D11E
    ----- ----- ----- -----
      a     Â´     âˆ     ğ„
```

å³ä½¿ä½¿ç”¨è¿™ç§è¡¨ç¤ºæ–¹æ³•ï¼Œæˆ‘ä»¬ä¹Ÿæ— æ³•ç¡®ä¿ç»“æœçš„æ­£ç¡®ã€‚

è¿™äº›é€šå¸¸ä¸æ˜¯æˆ‘ä»¬èƒ½å¤Ÿç®€å•æƒ³åˆ°çš„é—®é¢˜ã€‚è‹±è¯­æ˜¯é²œæœ‰çš„å‡ ç§ä»…ä½¿ç”¨ ASCII å­—ç¬¦å°±èƒ½è¡¨ç¤ºçš„è¯­è¨€ã€‚ä½ è‚¯å®šä¸æƒ³æŠŠæ±‚èŒæ—¶çš„ç®€å†ï¼ˆRÃ©sumÃ©ï¼‰æ”¹æˆã€ŒResumeã€å§ï¼ä¸€æ—¦è¶…å‡º ASCII å­—ç¬¦é›†ï¼Œè¿™äº›è’è°¬çš„é”™è¯¯å°±å¼€å§‹å‡ºç°äº†ã€‚

### å­—ç´ ç°‡ï¼ˆGrapheme Clustersï¼‰

Unicode ä¸­æœ‰ä¸ªæ¦‚å¿µå«åš*å­—ç´ ç°‡ï¼ˆGrapheme Clustersï¼‰*ï¼Œæœ¬è´¨ä¸Šå°±æ˜¯é˜…è¯»æ—¶ä¼šè¢«è€ƒè™‘æˆå•ä¸ªã€Œå­—ç¬¦ã€çš„æœ€å°å•å…ƒã€‚åœ¨å¤§å¤šæ•°è¡¨ç¤ºæ–¹æ³•ä¸­ï¼Œä¸€ä¸ªå­—ç´ ç°‡å°±ç­‰ä»·äºä¸€ä¸ªå•ç‹¬çš„ç ä½ï¼Œä½†æ˜¯ä¹Ÿæœ‰å¯èƒ½ä¼šè¡¨ç¤ºæˆåŒ…æ‹¬è¯­è°ƒæ ‡è®°çš„ä¸€éƒ¨åˆ†å†…å®¹ã€‚å¦‚æœæˆ‘ä»¬å°†ä¸Šé¢çš„ä¾‹å­è¡¨ç¤ºæˆå­—ç´ ç°‡çš„æ–¹å¼ï¼Œé‚£ä¹ˆå¾ˆæ˜¾ç„¶ä¼šæ˜¯è¿™æ ·çš„ï¼š

```
    a Ã© âˆ ğ„
```

ç§»é™¤ä»»æ„ä¸€ä¸ªä½œä¸ºå­—ç´ ç°‡çš„å•å…ƒï¼Œç•™ä¸‹çš„å†…å®¹éƒ½ä¼šè¢«è®¤ä¸ºæ˜¯åˆæƒ…åˆç†çš„ã€‚

æ³¨æ„åˆ°åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå¹¶æ²¡æœ‰ä»»ä½•çš„æ•°å­—ç­‰å€¼ (numeric equivalents) å­˜åœ¨ã€‚è¿™æ˜¯å› ä¸ºä¸ UTF-8ã€UTF-16 æˆ–è€…æ™®é€šçš„ Unicode ç ä½ä¸åŒï¼Œå•ä¸ªæ•°å­—æ— æ³•åœ¨ä¸€èˆ¬æƒ…å†µä¸‹è¡¨ç¤ºå­—ç´ ç°‡ (grapheme cluster) ã€‚æ‰€è°“å­—ç´ ç°‡ï¼ŒæŒ‡çš„æ˜¯ä¸€ä¸ªæˆ–å¤šä¸ªç ä½çš„åºåˆ—é›†åˆã€‚ä¸€ä¸ªå­—ç´ ç°‡é€šå¸¸ä¼šåŒ…å«ä¸€ä¸ªæˆ–ä¸¤ä¸ªç ä½ï¼Œä½†æ˜¯æŸäº›æƒ…å†µä¸‹ï¼ˆæ¯”å¦‚ [Zalgo](http://www.eeemo.net/) ä¸­ï¼‰å­—ç´ ç°‡ä¸­ä¹Ÿå¯èƒ½ä¼šåŒ…å«å¤§é‡çš„ç ä½ã€‚ä¾‹å¦‚ä¸‹é¢è¿™ä¸ªå­—ç¬¦ä¸²ï¼š

```
    eâƒâƒâƒŸâƒ âƒ£âƒ¤âƒ¥âƒ¦âƒªâƒ§ê™°ê™²ê™±
```

è¿™ä¸€å›¢ä¹±ä¸ƒå…«ç³Ÿçš„å­—ç¬¦ä¸²åŒ…æ‹¬äº† 14 ä¸ªä¸åŒçš„ç ä½ï¼š

    + U+0065
    + U+20DD
    + U+20DE
    + U+20DF
    + U+20E0
    + U+20E3
    + U+20E4
    + U+20E5
    + U+20E6
    + U+20E7
    + U+20EA
    + U+A670
    + U+A672
    + U+A671
    
æ‰€æœ‰çš„è¿™äº›ç ä½å•å…ƒéƒ½è¡¨ç¤ºä¸€ä¸ªå•ç‹¬çš„å­—ç´ ç°‡ã€‚

ä¸‹é¢æœ‰ä¸ªæœ‰è¶£çš„ä¾‹å­ã€‚æœ‰è¿™æ ·ä¸€ä¸ªåŒ…å«ç‘å£«å›½æ——çš„å­—ç¬¦ä¸²ï¼š

```
    ğŸ‡¨ğŸ‡­
```

è¿™ä¸ªæ ‡è®°å®é™…ä¸ŠåŒ…æ‹¬ä¸¤ä¸ªç ä½ï¼š`U+1F1E8 U+1F1ED`ã€‚è¿™ä¸¤ä¸ªç ä½åˆè¡¨ç¤ºä»€ä¹ˆæ„æ€å‘¢ï¼Ÿ

    + U+1F1E8 REGIONAL INDICATOR SYMBOL LETTER C
    + U+1F1ED REGIONAL INDICATOR SYMBOL LETTER H
    
Unicode åŒ…å«äº† 26 ä¸ªã€ŒRegional indicator symbolã€è€Œä¸æ˜¯å°†åœ°çƒä¸Šçš„æ‰€æœ‰å›½å®¶çš„å›½æ——ä½œä¸ºå•ç‹¬çš„ç ä½ã€‚å°† C å’Œ H çš„ä¸¤ä¸ªæ ‡è¯†ç¬¦åˆèµ·æ¥ä½ å°±èƒ½å¾—åˆ°ç‘å£«çš„å›½æ——ã€‚å°† M å’Œ X åˆèµ·æ¥ä¼šå¾—åˆ°å¢¨è¥¿å“¥å›½æ——ã€‚æ¯ä¸ªå›½æ——éƒ½æ˜¯ä¸€ä¸ªå•ç‹¬çš„å­—ç¬¦ç°‡ï¼Œä½†æ˜¯ç”±ä¸¤ä¸ªç ä½ç»„æˆï¼Œå³å››ä¸ª UTF-16 ç å…ƒæˆ–è€…å…«ä¸ª UTF-8 å­—èŠ‚ã€‚

### å­—ç¬¦ä¸² API å®ç°æ–¹å¼

æˆ‘ä»¬å‘ç°å­—ç¬¦ä¸²æœ‰å¤šç§ç†è§£æ–¹æ³•ï¼Œä¹Ÿæœ‰å¤šç§è¡¨ç¤ºã€Œå­—ç¬¦ã€çš„æ–¹å¼ã€‚å°†ã€Œå­—ç¬¦ã€å½“åšä¸€ä¸ªå­—ç´ ç°‡å¯èƒ½æœ€æ¥è¿‘äººä»¬å¯¹äºã€Œå­—ç¬¦ã€çš„ç†è§£ï¼Œä½†æ˜¯åœ¨ä»£ç ä¸­æ“ä½œå­—ç¬¦ä¸²æ—¶ï¼Œè¦ä¾æ®è¯­è¨€ç¯å¢ƒæ¥åˆ¤æ–­æ‰€è°“ã€Œå­—ç¬¦ã€çš„å«ä¹‰ã€‚å½“åœ¨æ–‡æœ¬ä¸­ç§»åŠ¨æ’å…¥å…‰æ ‡æ—¶ï¼Œå…‰æ ‡ç»è¿‡çš„å­—ç¬¦å°±æ˜¯æŒ‡å­—ç´ ç°‡ã€‚å½“ä¸ºäº†ä¿è¯æ–‡æœ¬æ»¡è¶³ 140 å­—é™åˆ¶çš„æ¨æ–‡æ—¶ï¼Œè¿™é‡Œçš„å­—ç¬¦å°±æ˜¯ Unicode ç ä½ã€‚å½“å­—ç¬¦ä¸²æƒ³è¦ä¿å­˜åœ¨é™å®šé•¿åº¦æ˜¯ 80 ä¸ªå­—ç¬¦çš„æ•°æ®åº“è¡¨ä¸­æ—¶ï¼Œè¿™é‡Œçš„å­—ç¬¦å°±æ˜¯ä¸ª UTF-8 å­—èŠ‚ã€‚

é‚£ä¹ˆå½“ä½ åœ¨å®ç°å­—ç¬¦ä¸²æ—¶ï¼Œå¦‚ä½•æ¥å¹³è¡¡æ€§èƒ½ã€å†…å­˜ä½¿ç”¨å’Œç®€æ´ä»£ç ä¸‰è€…å‘¢ï¼Ÿ

é€šå¸¸çš„å›ç­”æ˜¯é€‰æ‹©ä¸€ç§æ ‡å‡†åŒ–è¡¨ç¤ºï¼ˆcanonical representationï¼‰ï¼Œä¹‹ååœ¨éœ€è¦å…¶ä»–è¡¨ç¤ºæ–¹æ³•æ—¶è¿›è¡Œè½¬æ¢ã€‚ä¾‹å¦‚ï¼Œ`NSString` ä½¿ç”¨ UTF-16 ä½œä¸ºå…¶æ ‡å‡†åŒ–è¡¨ç¤ºæ³•ã€‚æ•´ä¸ª API åŸºäº UTF-16 å»ºç«‹ã€‚å¦‚æœä½ æƒ³è¦å¤„ç† UTF-8 æˆ–è€… Unicode ç ä½ï¼Œä½ éœ€è¦å°†åŸå§‹å­—ç¬¦ä¸²è½¬åŒ–æˆ UTF-8 æˆ–è€… UTF-32 è¡¨ç¤ºç„¶åå†å¯¹ç»“æœè¿›è¡Œæ“ä½œã€‚è¿™ç§å¤„ç†æ–¹å¼æ›´å¤šæ˜¯å°†å­—ç¬¦ä¸²è§†ä¸ºæ•°æ®å¯¹è±¡ï¼Œè€Œä¸æ˜¯è§†ä¸ºå­—ç¬¦ä¸²æœ¬èº«ï¼Œæ‰€ä»¥åœ¨è½¬æ¢æ—¶å¹¶ä¸æ˜¯å¾ˆæ–¹ä¾¿ã€‚å¦‚æœä½ è¦å¯¹å­—ç¬¦ç°‡è¿›è¡Œæ“ä½œï¼Œè¿˜éœ€è¦ä½¿ç”¨ `rangeOfComposedCharacterSequencesForRange:` æ–¹æ³•æ‰¾åˆ°å®ƒä»¬å’Œå…¶ä»–å­—ç¬¦çš„åˆ†ç•Œä½ç½®ï¼Œè¿™æ˜¯ä¸€é¡¹éå¸¸æ¯ç‡¥çš„ä»»åŠ¡ã€‚

Swift çš„ `String` ç±»å‹åˆ™é‡‡ç”¨äº†å¦å¤–ä¸€ç§æ–¹æ³•ã€‚åœ¨è¿™é‡Œé¢æ²¡æœ‰æ ‡å‡†åŒ–çš„è¡¨ç¤ºï¼Œè€Œæ˜¯ä¸ºå­—ç¬¦ä¸²çš„ä¸åŒè¡¨ç¤ºæ–¹å¼æä¾›äº†*è§†å›¾ï¼ˆviewï¼‰*ã€‚è¿™æ ·æ— è®ºå¤„ç†å“ªç§è¡¨ç¤ºæ–¹å¼ï¼Œä½ éƒ½èƒ½å¤Ÿçµæ´»è‡ªå¦‚åœ°æ“ä½œã€‚

### ç®€è¿° Swift ä¸­çš„ String API

åœ¨æ—§ç‰ˆæœ¬ä¸­çš„ Swift ä¸­ï¼Œ`String` ç±»éµå¾ªäº† `CollectionType` æ¥å£ï¼Œå°†è‡ªå·±çœ‹åšæ˜¯ `Character` å…ƒç´ çš„é›†åˆã€‚åœ¨ Swift 2 ä¸­ï¼Œè¿™ç§è¡¨ç¤ºå·²ç»ä¸å¤å­˜åœ¨ï¼Œ`String` ç±»ä¼šæ ¹æ®ä½¿ç”¨çš„ä¸åŒæƒ…å†µï¼Œå±•ç°å‡ºä¸åŒçš„è¡¨ç°æ–¹å¼ã€‚

è¿™ç§è¡¨ç¤ºæ–¹å¼è¿˜ä¸æ˜¯å¾ˆå®Œå–„ï¼Œ`String` ä»ç„¶æœ‰ç‚¹å€¾å‘äº `Character` é›†åˆçš„è¡¨ç¤ºæ–¹å¼ï¼Œå®ƒä¾æ—§æä¾›äº†æœ‰ç‚¹ç±»ä¼¼é›†åˆå¤„ç†çš„æ¥å£ï¼š

```swift
    public typealias Index = String.CharacterView.Index
    public var startIndex: Index { get }
    public var endIndex: Index { get }
    public subscript (i: Index) -> Character { get }
```

ä½ å¯ä»¥é€šè¿‡ `String` çš„ç´¢å¼•è·å¾—å•ç‹¬çš„ `Character`ã€‚æ³¨æ„ï¼Œä½ å¹¶ä¸èƒ½é€šè¿‡æ ‡å‡†çš„ `for in` è¯­æ³•éå†æ•´ä¸ªå­—ç¬¦ä¸²ã€‚

åœ¨ Swift çœ‹æ¥ï¼Œä¸€ä¸ªã€Œå­—ç¬¦ã€ç©¶ç«Ÿæ˜¯ä»€ä¹ˆï¼Ÿæ­£å¦‚æˆ‘ä»¬æ‰€è§ï¼Œæœ‰å¤ªå¤šçš„å¯èƒ½æ€§ã€‚Swift ä¸­ String API çš„å®ç°åŸºç¡€æ˜¯å°†ä¸€ä¸ªå­—ç´ ç°‡çœ‹ä½œä¸€ä¸ªã€Œå­—ç¬¦ã€ã€‚è¿™çœ‹ä¸Šå»æ˜¯ä¸€ä¸ªéå¸¸ä¸é”™çš„é€‰æ‹©ï¼Œå› ä¸ºæ­£å¦‚æˆ‘ä»¬æ‰€è§ï¼Œè¿™ç§æ–¹å¼ç¬¦åˆäººç±»åœ¨å­—ç¬¦ä¸²ä¸­å¯¹äºä¸€ä¸ªã€Œå­—ç¬¦ã€çš„å®šä¹‰ã€‚

ä¸åŒçš„è§†å›¾åœ¨ `String` ç±»ä¸­ä½œä¸ºå±æ€§å±•ç°ã€‚ä¾‹å¦‚ï¼Œ`characters` å±æ€§ï¼š

```swift
    public var characters: String.CharacterView { get }
```

`CharacterView` æ˜¯ `Character` çš„ä¸€ä¸ªé›†åˆï¼š

```swift
    extension String.CharacterView : CollectionType {
        public struct Index ...
        public var startIndex: String.CharacterView.Index { get }
        public var endIndex: String.CharacterView.Index { get }
        public subscript (i: String.CharacterView.Index) -> Character { get }
    }
```

è¿™çœ‹ä¸Šå»æœ‰ç‚¹åƒ `String` æ¥å£æœ¬èº«ï¼Œé™¤äº†å®ƒéµå¾ª `CollectionType` åè®®å¹¶ä¸”æ‹¥æœ‰æ‰€æœ‰ `CollectionType` æä¾›çš„æ–¹æ³•å¤–ï¼Œå®ƒå®ç°äº†åˆ’åˆ†ï¼ˆsliceï¼‰ã€éå†ï¼ˆiterateï¼‰ã€æ˜ å°„ï¼ˆmapï¼‰æˆ–è€…è®¡æ•°ï¼ˆcountï¼‰æ–¹æ³•ã€‚æ‰€ä»¥å°½ç®¡ä¸‹é¢çš„æ–¹æ³•æ˜¯ä¸è¢«å…è®¸çš„ï¼š

```swift
    for x in "abc" {}
```

ä½†æ˜¯è¿™æ˜¯è¡Œå¾—é€šçš„ï¼š

```swift
    for x in "abc".characters {}
```

ä½ å¯ä»¥ä½¿ç”¨æ„é€ å‡½æ•°ä» `CharacterView` ä¸­è·å¾—ä¸€ä¸ªå­—ç¬¦ä¸²ï¼š

```swift
    public init(_ characters: String.CharacterView)
```

ä½ ç”šè‡³å¯ä»¥ä»éšæœºåºåˆ—ä¸­è·å– `Character` ä½œä¸ºä¸€ä¸ªå­—ç¬¦ä¸²ï¼š

```swift
    public init<S : SequenceType where S.Generator.Element == Character>(_ characters: S)
    // è¯‘è€…æ³¨ï¼šç°åœ¨æ˜¯ public init(_ characters: String.CharacterView)
```

ç»§ç»­æˆ‘ä»¬çš„æ—…ç¨‹ï¼Œä¸‹ä¸€ä¸ªæ˜¯ UTF-32 å­—ç¬¦è§†å›¾ã€‚Swift æŠŠ UTF-32 ç å…ƒå«åšã€ŒUnicode æ ‡é‡ï¼ˆunicode scalarsï¼‰ã€ï¼ˆè¯‘è€…æ³¨ï¼šå‚çœ‹ [Unicode scalar values](http://www.unicode.org/glossary/#unicode_scalar_value)ï¼‰ï¼Œå› ä¸º UTF-32 ç å…ƒä¸ Unicode ç ä½æ˜¯ç­‰åŒçš„ã€‚è¿™ä¸ªï¼ˆç®€åŒ–çš„ï¼‰æ¥å£çœ‹ä¸Šå»æ˜¯è¿™æ ·çš„ï¼š

```swift
    public var unicodeScalars: String.UnicodeScalarView

    public struct UnicodeScalarView : CollectionType, _Reflectable, CustomStringConvertible, CustomDebugStringConvertible {
        public struct Index ...
        public var startIndex: String.UnicodeScalarView.Index { get }
        public var endIndex: String.UnicodeScalarView.Index { get }
        public subscript (position: String.UnicodeScalarView.Index) -> UnicodeScalar { get }
    }
```

ç±»ä¼¼äº `CharacterView`ï¼Œåœ¨ `UnicodeScalarView` å†…éƒ¨ä¹Ÿæœ‰ä¸ª `String` çš„æ„é€ å‡½æ•°ï¼š

```swift
    public init(_ unicodeScalars: String.UnicodeScalarView)
```

ä¸å¹¸çš„æ˜¯ï¼Œ`UnicodeScalar` åºåˆ—æ²¡æœ‰å®ä¾‹åŒ–æ–¹æ³•ï¼Œæ‰€ä»¥åœ¨æ“ä½œæ—¶éœ€è¦åšä¸€ç‚¹é¢å¤–å·¥ä½œï¼Œä¾‹å¦‚ï¼Œéœ€è¦å°†è¿™äº›å­—ç¬¦è½¬æ¢æˆæ•°ç»„ï¼Œç„¶åå†å°†æ•°ç»„è½¬åŒ–æˆå­—ç¬¦ä¸²ã€‚åŒæ—¶ï¼Œåœ¨ `UnicodeScalarView` ä¸­ä¹Ÿæ²¡æœ‰æ¥å— `UnicodeScalar` åºåˆ—ä½œä¸ºå‚æ•°çš„å®ä¾‹åŒ–æ–¹æ³•ã€‚ç„¶è€Œï¼ŒSwift æä¾›äº†ä¸€ä¸ªåœ¨å°¾éƒ¨æ·»åŠ å…ƒç´ çš„å‡½æ•°ï¼Œæ‰€ä»¥ä½ å¯ä»¥é€šè¿‡ä¸‹é¢ä¸‰æ­¥å»ºç«‹ä¸€ä¸ª `String`ã€‚

```swift
    var unicodeScalarsView = String.UnicodeScalarView()
    unicodeScalarsView.appendContentsOf(unicodeScalarsArray)
    let unicodeScalarsString = String(unicodeScalarsView)
```

æ¥ä¸‹æ¥æ˜¯ UTF-16 å­—ç¬¦è§†å›¾ï¼Œçœ‹ä¸Šå»å’Œå…¶ä»–çš„ä¹Ÿå¾ˆç±»ä¼¼ï¼š

```swift
    public var utf16: String.UTF16View { get }

    public struct UTF16View : CollectionType {
        public struct Index ...
        public var startIndex: String.UTF16View.Index { get }
        public var endIndex: String.UTF16View.Index { get }
        public subscript (i: String.UTF16View.Index) -> CodeUnit { get }
    }
```

åœ¨è¿™ä¸ªè§†å›¾ä¸­ï¼Œ`String` çš„å®ä¾‹åŒ–æ–¹æ³•åˆæœ‰ç»†å¾®çš„å·®åˆ«ï¼š

```swift
    public init?(_ utf16: String.UTF16View)
```

ä¸å…¶ä»–çš„æ–¹æ³•ä¸åŒï¼Œè¿™æ˜¯ä¸€ä¸ªå¯èƒ½ä¼šæ„é€ å¤±è´¥çš„æ„é€ æ–¹æ³•ï¼ˆè¯‘è€…æ³¨ï¼šæ³¨æ„ `init?`ï¼‰ã€‚ä»»ä½• `Character` æˆ–è€… `UnicodeScalar` çš„åºåˆ—éƒ½æ˜¯ä¸€ä¸ªåˆæ³•çš„ `String`ï¼Œä½†æ˜¯å¯¹äºä»¥ UTF-16 ä½œä¸ºç å…ƒçš„åºåˆ—ï¼Œå¯èƒ½æ— æ³•å°†å…¶è½¬åŒ–æˆä¸€ä¸ªåˆæ³•çš„å­—ç¬¦ä¸²ã€‚å½“å†…å®¹éæ³•æ—¶ï¼Œæ„é€ æ–¹æ³•å°†è¿”å› `nil`ã€‚

å°†ä»»æ„ä¸€ä¸ª UTF-16 ç å…ƒåºåˆ—è½¬æ¢æˆä¸€ä¸ª `String` ç±»å‹çš„å­—ç¬¦ä¸²éå¸¸å›°éš¾ã€‚`UTF16View` æ²¡æœ‰å…¬å…±çš„æ„é€ æ–¹æ³•ï¼Œå¹¶ä¸”åªæœ‰å¾ˆå°‘å‡ ä¸ªè½¬æ¢æ–¹æ³•ã€‚è¿™ä¸ªé—®é¢˜çš„è§£å†³æ–¹æ³•å°±æ˜¯ä½¿ç”¨å…¨å±€ `transcode` å‡½æ•°ï¼Œå®ƒå·²ç»éµå¾ª `UnicodeCodecType` åè®®ã€‚`UTF8`ã€`UTF16` å’Œ `UTF32` è¿™ä¸‰ä¸ªç±»ä¸­åˆ†åˆ«å®ç°äº†è¿™ä¸ªåè®®ï¼Œé€šè¿‡ `transcode` å‡½æ•°å¯ä»¥å®ç°ä¸‰è€…çš„äº’ç›¸è½¬åŒ–ï¼Œè™½ç„¶å¾ˆä¸ä¼˜é›…ã€‚å¯¹äºè¾“å…¥ï¼Œå‡½æ•°æ¥å—ä¸€ä¸ª `GeneratorType` ç±»å‹çš„å‚æ•°ï¼Œä¸­é—´é€šè¿‡ä¸€ä¸ªç”¨äºäº§ç”Ÿè¾“å‡ºç»“æœæ¯ä¸€ä½çš„å‡½æ•°è¿›è¡Œè½¬åŒ–ã€‚è¿™å¯å°†ä¸€ä¸ª `UTF16` å­—ç¬¦ä¸²ä¸€ç‚¹ä¸€ç‚¹åœ°è½¬åŒ–æˆ `UTF32` ç±»å‹å­—ç¬¦ä¸²ï¼Œæ¥ç€å†å°†æ¯ä¸ª `UTF-32` ç å…ƒè½¬åŒ–æˆå¯¹åº”çš„ `UnicodeScalar`ï¼Œæ‹¼æ¥åˆ° `String` ä¸­ï¼š

```swift
    var utf16String = ""
    transcode(UTF16.self, UTF32.self, utf16Array.generate(), { utf16String.append(UnicodeScalar($0)) }, stopOnError: true)
    // è¯‘è€…æ³¨ï¼štranscode æ–¹æ³•çš„å‡ ä¸ªå‚æ•°ï¼š
    // 1. inputEncoding: InputEncoding.Type
    // 2. _ outputEncoding: OutputEncoding.Type
    // 3. _ input: Input
    // 4. _ output: (OutputEncoding.CodeUnit) -> ()
    // 5. stopOnError: Bool
    // è¿™é‡Œç¼ºå°‘ utf16Arrayï¼Œå¯ä»¥å°è¯•åœ¨ç¬¬äºŒè¡Œä»£ç å‰åŠ å…¥
    // let utf16Array = Array(String(count: 9999, repeatedValue: Character("X")).utf16)
    // æ¥æµ‹è¯•ç»“æœ
```

æœ€åæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ UTF-8 å­—ç¬¦è§†å›¾ã€‚å®ç°æ–¹å¼å’Œæˆ‘ä»¬ä¹‹å‰ä»‹ç»çš„ä¸€æ ·ï¼š

```swift
    public var utf8: String.UTF8View { get }

    public struct UTF8View : CollectionType {
        /// A position in a `String.UTF8View`.
        public struct Index ...
        public var startIndex: String.UTF8View.Index { get }
        public var endIndex: String.UTF8View.Index { get }
        public subscript (position: String.UTF8View.Index) -> CodeUnit { get }
    }
```

å¦å¤–åœ¨å®šä¹‰ä¸­ä¹Ÿæœ‰ä¸€ä¸ªæ„é€ å‡½æ•°ã€‚å’Œ `UTF16View` ä¸€æ ·ï¼Œè¿™ä¹Ÿæ˜¯ä¸€ä¸ªå¯èƒ½å¤±è´¥çš„æ„é€ æ–¹æ³•ï¼Œå› ä¸ºç”± UTF-8 ç å…ƒç»„æˆçš„åºåˆ—ä¹Ÿæœ‰å¯èƒ½æ˜¯ä¸åˆæ³•çš„ã€‚

```swift
    public init?(_ utf8: String.UTF8View)
```

å’Œå‰è€…ç±»ä¼¼ï¼Œè¿™å„¿ä¹Ÿæ²¡æœ‰ä¸€ç§ç®€ä¾¿çš„æ–¹æ³•å°†ä»»æ„ä¸€ä¸ª UTF-8 ç å…ƒç»„æˆçš„åºåˆ—è½¬æ¢æˆ `String` ç±»å‹ã€‚ä»ç„¶å¯ä»¥ä½¿ç”¨ transcode æ–¹æ³•ï¼š

```swift
    var utf8String = ""
    transcode(UTF8.self, UTF32.self, utf8Array.generate(), { utf8String.append(UnicodeScalar($0)) }, stopOnError: true)
    // è¯‘è€…æ³¨ï¼šè‡ªè¡Œè¡¥å…… utf8Array
```

å› ä¸ºæ¯æ¬¡è°ƒç”¨ `transcode` æ–¹æ³•å®åœ¨æ˜¯å¤ªç—›è‹¦äº†ï¼Œæˆ‘å°†å®ƒä»¬ç”¨åœ¨äº†è¿™ä¸€å¯¹å¯èƒ½ä¼šæ„é€ å¤±è´¥çš„æ„é€ å‡½æ•°ä¸­ï¼š

```swift
    extension String {
        init?<Seq: SequenceType where Seq.Generator.Element == UInt16>(utf16: Seq) {
            self.init()

            guard transcode(UTF16.self,
                            UTF32.self,
                            utf16.generate(),
                            { self.append(UnicodeScalar($0)) },
                            stopOnError: true)
                            == false else { return nil }
        }

        init?<Seq: SequenceType where Seq.Generator.Element == UInt8>(utf8: Seq) {
            self.init()

            guard transcode(UTF8.self,
                            UTF32.self,
                            utf8.generate(),
                            { self.append(UnicodeScalar($0)) },
                            stopOnError: true)
                            == false else { return nil }
        }
    }
```

é€šè¿‡è¿™ä¸ªæ„é€ å‡½æ•°ï¼Œæˆ‘ä»¬èƒ½å°†ä»»æ„ä¸€ä¸ª UTF-8 æˆ– UTF-16 ç å…ƒç»„æˆçš„åºåˆ—è½¬åŒ–æˆ `String` ç±»å‹çš„å­—ç¬¦ä¸²ï¼š

```swift
    String(utf16: utf16Array)
    String(utf8: utf8Array)
```

### ç´¢å¼•

ä¸Šé¢ä»‹ç»çš„ä¸åŒè§†å›¾éƒ½å¯ç”¨äºç´¢å¼• ï¼ˆIndexesï¼‰é›†åˆï¼Œä½†æ˜¯å®ƒä»¬å¹¶*ä¸*æ˜¯æ•°ç»„ã€‚ç´¢å¼•ç±»å‹æ˜¯ä¸€ç§éå¸¸è¯¡å¼‚çš„è‡ªå®šä¹‰`ç»“æ„ä½“ï¼ˆstructï¼‰`ã€‚è¿™æ„å‘³ç€ä½ ä¸èƒ½é€šè¿‡æ•°å­—æ¥è¯»å–ä¸åŒè§†å›¾ä¸­çš„å†…å®¹ï¼š

```swift
    // all errors
    string[2]
    string.characters[2]
    string.unicodeScalars[2]
    string.utf16[2]
    string.utf8[2]
```

ä¸è¿‡ä½ å¯ä»¥ä½¿ç”¨é›†åˆç±»å‹çš„ `startIndex` æˆ–è€…æ˜¯ `endIndex` å±æ€§ï¼Œå¹¶ä¸”ä½¿ç”¨ `successor()` æˆ–è€… `advancedBy()` æ–¹æ³•æ¥ç§»åŠ¨åˆ°åˆé€‚çš„ä½ç½®ï¼š

```swift
    // these work
    string[string.startIndex.advancedBy(2)]
    string.characters[string.characters.startIndex.advancedBy(2)]
    string.unicodeScalars[string.unicodeScalars.startIndex.advancedBy(2)]
    string.utf16[string.utf16.startIndex.advancedBy(2)]
    string.utf8[string.utf8.startIndex.advancedBy(2)]
```

è¿™å¹¶ä¸æ˜¯ä»¶æœ‰è¶£çš„äº‹ï¼Œæˆ‘ä»¬æƒ³çŸ¥é“åˆ°åº•å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ

è¿˜è®°å¾—è¿™äº›ä»¥æ ‡å‡†åŒ–è¡¨ç¤ºä¿å­˜åœ¨å­—ç¬¦ä¸²å¯¹è±¡çš„è§†å›¾å—ï¼Ÿå½“ä½ ä½¿ç”¨äº†ä¸€ä¸ªä¸ç¬¦åˆæ ‡å‡†åŒ–è¡¨ç¤ºå½¢å¼çš„è§†å›¾æ—¶ï¼Œå­˜å‚¨çš„æ•°æ®å¹¶ä¸èƒ½è‡ªåŠ¨è½¬åŒ–æˆä½ æƒ³è¦çš„å½¢å¼ã€‚

å›æƒ³ä¸€ä¸‹ä¸Šé¢æ‰€æåˆ°çš„ï¼Œä¸åŒçš„ç¼–ç æ–¹å¼æœ‰ä¸åŒçš„å¤§å°å’Œé•¿åº¦ã€‚è¿™ä¹Ÿæ„å‘³ç€æ— æ³•ç®€å•åœ°åˆ¤æ–­å­—ç¬¦åœ¨ä¸åŒè§†å›¾ä¸­å¯¹åº”çš„ä½ç½®ï¼Œå› ä¸ºæ‰€æ˜ å°„åˆ°çš„ä½ç½®æ˜¯æ ¹æ®ä¿å­˜çš„æ•°æ®ä¸åŒè€Œä¸åŒçš„ã€‚è€ƒè™‘ä¸‹é¢è¿™ä¸ªå­—ç¬¦ä¸²ï¼š

```
    AÆå·¥ğŸ„
```

è¿™ä¸ª `String` ç±»å‹çš„å­—ç¬¦ä¸²åœ¨ UTF-32 ç¼–ç ä¸‹çš„æ ‡å‡†åŒ–è¡¨ç¤ºæ˜¯å‡ ä¸ª 32 ä½æ•´å‹å…ƒç´ çš„é›†åˆï¼š

```
    0x00041 0x0018e 0x05de5 0x1f11e
```

æˆ‘ä»¬å†ç«™åœ¨ UTF-8 ç¼–ç çš„è§†è§’ä¸Šæ¥çœ‹è¿™äº›æ•°æ®ã€‚ç†è®ºä¸Šè¯´ï¼Œè¿™äº›æ•°æ®å°±æ˜¯ä¸€ç»„ 8 ä½æ•´å‹å…ƒç´ çš„åºåˆ—ï¼š

```
    0x41 0xc6 0x8e 0xe5 0xb7 0xa5 0xf0 0x9f 0x84 0x9e
```

ä¸‹é¢æ˜¯ä¸¤è€…çš„æ˜ å°„å…³ç³»ï¼š

```
    | 0x00041 |  0x0018e  |     0x05de5    |       0x1f11e       |
    |         |           |                |                     |
    |  0x41   | 0xc6 0x8e | 0xe5 0xb7 0xa5 | 0xf0 0x9f 0x84 0x9e |
```

å¦‚æœéœ€è¦è·å–åœ¨ UTF-8 è§†å›¾ä¸‹ç´¢å¼•ä¸º 6 çš„å€¼ï¼Œé‚£ä¹ˆå¿…é¡»å»ä» UTF-32 çš„åºåˆ—ä¸­ä»å¤´å¼€å§‹å»æ‰«æï¼Œç„¶åè·å–æ‰€åœ¨ä½ç½®æ‰€å¯¹åº”çš„å€¼ã€‚

æ˜¾ç„¶ï¼Œè¿™æ˜¯å¯ä»¥åšåˆ°çš„ã€‚Swift æä¾›äº†è¿™ç§åº•å±‚æ–¹æ³•ï¼Œä½†æ˜¯é•¿å¾—å¹¶ä¸å¥½çœ‹ï¼š`string.utf8[string.utf8.startIndex.advancedBy(6)]`ã€‚ä¸ºä»€ä¹ˆä¸èƒ½ç®€åŒ–è¿™ç§è¡¨ç¤ºï¼Œç›´æ¥ç”¨ä¸€ä¸ªæ•´æ•°æ¥è®¿é—®ç´¢å¼•å‘¢ï¼Ÿå®é™…ä¸Š Swift ä¸ºäº†åŠ å¼ºè¿™ç§è¡¨ç¤ºç‰ºç‰²äº†ç®€æ´æ€§ã€‚åœ¨ä¸€ä¸ª `UTF8View` èƒ½æä¾› `subscript(Int)ï¼ˆè¯‘è€…æ³¨ï¼šå³ä¸‹æ ‡ç´¢å¼•ï¼‰` æ–¹æ³•çš„ä¸–ç•Œé‡Œï¼Œæˆ‘ä»¬å¸Œæœ›ä¸‹é¢ä¸¤æ®µä»£ç æ˜¯ç­‰ä»·çš„ï¼š

```swift
    for c in string.utf8 {
        ...
    }

    for i in 0..<string.utf8.count {
        let c = string.utf8[i]
        ...
    }
```

è¿™çœ‹ä¸Šå»å¾ˆç›¸ä¼¼ï¼Œä½†æ˜¯ç¬¬äºŒä¸ªä¼šæ„å¤–åœ°æ›´æ…¢ä¸€äº›ã€‚ç¬¬ä¸€ä¸ªå¾ªç¯æ˜¯ä¸€ä¸ªçº¿æ€§æ—¶é—´çš„æ‰«æï¼Œç„¶è€Œç¬¬äºŒä¸ªå¾ªç¯éœ€è¦å¯¹æ¯æ¬¡è¿­ä»£åšä¸€æ¬¡çº¿æ€§æ‰«æï¼Œå³éœ€è¦ç”¨äºŒæ¬¡æ–¹é¡¹çš„æ—¶é—´æ¥åšè¿­ä»£éå†ã€‚å¯¹äºä¸€ä¸ªé•¿åº¦ä¸ºä¸€ç™¾ä¸‡çš„å­—ç¬¦ä¸²ï¼Œç¬¬ä¸€ä¸ªå¾ªç¯åªéœ€è¦ 0.1 ç§’ï¼Œè€Œç¬¬äºŒä¸ªå¾ªç¯éœ€è¦ 3 ä¸ªå°æ—¶ï¼ˆåœ¨æˆ‘çš„ 2013 å¹´ MacBook Pro ä¸Šè¿›è¡Œçš„æµ‹è¯•ï¼‰ã€‚

æˆ‘ä»¬å†æ¥çœ‹å¦å¤–ä¸€ä¸ªä¾‹å­ï¼Œä»å­—ç¬¦ä¸²ä¸­è·å¾—æœ€åä¸€ä¸ªå­—ç¬¦ï¼š

```swift
    let lastCharacter = string.characters[string.characters.endIndex.predecessor()]

    let lastCharacter = string.characters[string.characters.count - 1]
```

ç¬¬ä¸€ä¸ªç‰ˆæœ¬ä¼šæ›´å¿«ä¸€äº›ã€‚å› ä¸ºå®ƒç›´æ¥ä»å­—ç¬¦ä¸²çš„æœ€åå¼€å§‹ï¼Œä»æœ€åä¸€ä¸ª `Character` å¼€å§‹çš„åœ°æ–¹ä»åå¾€å‰æœç´¢ï¼Œç„¶åè·å–å­—ç¬¦ã€‚ç¬¬äºŒä¸ªç‰ˆæœ¬ä¼šæ‰«ææ•´ä¸ªå­—ç¬¦ä¸²â€¦â€¦*ä¸¤æ¬¡ï¼*å®ƒé¦–å…ˆå¾—æ‰«ææ•´ä¸ªå­—ç¬¦ä¸²æ¥è·å–æœ‰å¤šå°‘ä¸ª `Character`ï¼Œæ¥ç€*å†ä¸€æ¬¡*æ‰«æç‰¹å®šåºå·çš„å­—ç¬¦æ˜¯ä»€ä¹ˆã€‚

ç±»ä¼¼è¿™æ ·çš„ API åœ¨ Swift ä¸­åªæ˜¯æœ‰ç‚¹ä¸åŒã€æœ‰ç‚¹éš¾å†™ã€‚è¿™äº›ä¸åŒä¹‹å¤„è®©ç¨‹åºå‘˜ä»¬çŸ¥é“äº†è§†å›¾å¹¶ä¸æ˜¯æ•°ç»„ï¼Œå®ƒä»¬ä¹Ÿæ²¡æœ‰æ•°ç»„çš„è¡Œä¸ºã€‚å½“æˆ‘ä»¬ä½¿ç”¨ä¸‹æ ‡ç´¢å¼•æ—¶ï¼Œæˆ‘ä»¬äº‹å®ä¸Šå‡è®¾äº†è¿™ç§æ“ä½œæ˜¯ä¸€ç§æ•ˆç‡å¾ˆé«˜çš„è¡Œä¸ºã€‚å¦‚æœ `String` çš„è§†å›¾æä¾›äº†è¿™ç§ç´¢å¼•ï¼Œé‚£å…¶å®å’Œæˆ‘ä»¬çš„ä¸»è§‚å‡è®¾ç›¸åï¼Œåªèƒ½å†™å‡ºæ•ˆç‡å¾ˆä½çš„ä»£ç ã€‚

### ä½¿ç”¨ `String` ç±»æ¥å†™ä»£ç å§

åœ¨åº”ç”¨å±‚é¢ä¸Šä½¿ç”¨ `String` ç±»å†™ä»£ç æ„å‘³ç€ä»€ä¹ˆå‘¢ï¼Ÿ

ä½ å¯ä»¥ä½¿ç”¨é¡¶å±‚ APIã€‚ä¸¾ä¸ªä¾‹å­ï¼Œå¦‚æœä½ éœ€è¦åˆ¤æ–­ä¸€ä¸ªå­—ç¬¦ä¸²æ˜¯å¦æ˜¯ä»¥æŸä¸ªå­—ç¬¦å¼€å¤´çš„ï¼Œé‚£ä¸éœ€è¦å¯¹å­—ç¬¦ä¸²ç´¢å¼•ç„¶åè·å–ç¬¬ä¸€ä¸ªå­—ç¬¦å¹¶åšæ¯”è¾ƒã€‚ç›´æ¥ä½¿ç”¨ `hasPrefix` æ–¹æ³•ï¼Œå®ƒå·²ç»ä¸ºä½ å‡†å¤‡å¥½äº†ä¸€åˆ‡ã€‚ä¸è¦å®³æ€•å¯¼å…¥ Foundation åº“å’Œä½¿ç”¨ `NSString` ä¸­çš„æ–¹æ³•ã€‚å½“ä½ æƒ³ç§»é™¤ `String` å¼€å¤´å’Œç»“å°¾å¤šä½™çš„ç©ºæ ¼æ—¶ï¼Œä¸å¿…æ‰‹åŠ¨éå†è·å–è¿™äº›å­—ç¬¦ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ `stringByTrimmingCharactersInSet` æ–¹æ³•ã€‚

å¦‚æœä½ éœ€è¦åšä¸€äº›å­—ç¬¦å±‚é¢çš„äº‹æƒ…ï¼Œé‚£ä¹ˆå°±è¦æƒ³è±¡ä¸€ä¸‹ï¼Œå¯¹äºç‰¹å®šæƒ…å†µä¸€ä¸ªã€Œå­—ç¬¦ã€æ„å‘³ç€ä»€ä¹ˆã€‚é€šå¸¸ï¼Œæ­£ç¡®ç­”æ¡ˆæ˜¯æŒ‡ä¸€ä¸ªå­—ç´ ç°‡ï¼Œè¿™åœ¨ Swift ä¸­è¡¨ç¤ºæˆ `Character` ç±»å‹ï¼Œå±•ç°åœ¨ `characters` è§†å›¾ä¸­ã€‚

æ— è®ºä½ éœ€è¦å¯¹æ–‡æœ¬åšäº›ä»€ä¹ˆäº‹æƒ…ï¼Œéƒ½è¦æ€è€ƒä¸€ä¸‹å¯¹æ–‡æœ¬ä»å¤´åˆ°å°¾çº¿æ€§æ‰«æçš„äº‹æƒ…ã€‚è¯¸å¦‚è®¡ç®—æœ‰å¤šå°‘ä¸ªå­—ç¬¦ã€æŸ¥æ‰¾ä¸­é—´çš„å­—ç¬¦è¿™ç±»æ“ä½œä¼šæ¶ˆè€—çº¿æ€§çš„æ—¶é—´ï¼Œæ‰€ä»¥ä½ æœ€å¥½æ•´ç†ä¸€ä¸‹ä»£ç ï¼Œæ›´åŠ å¹²å‡€åˆ©è½åœ°åšè¿™äº›çº¿æ€§æ—¶é—´æ‰«æçš„æ“ä½œã€‚å¯¹äºç‰¹å®šçš„è§†å›¾ï¼Œå–å¾—å¼€å§‹å’Œç»“æŸçš„ä¸‹æ ‡ç´¢å¼•ï¼Œåœ¨å¿…è¦çš„æ—¶å€™ä½¿ç”¨ `advancedBy()` æˆ–è€…å…¶ä»–ç±»ä¼¼çš„æ–¹æ³•æ¥ç§»åŠ¨ç´¢å¼•çš„ä½ç½®ã€‚

### æ€»ç»“

Swift ä¸­çš„ `String` ç±»å‹é‡‡å–äº†ä¸€ç§ä¸ä¼—ä¸åŒçš„æ–¹æ³•æ¥å¤„ç†å­—ç¬¦ä¸²ã€‚å…¶ä»–å¾ˆå¤šè¯­è¨€ä¼šé€‰æ‹©ä¸€ç§æ ‡å‡†åŒ–è¡¨ç¤ºæ³•ï¼Œç„¶åå°†è½¬æ¢ç­‰æ“ä½œç•™ç»™ç¨‹åºå‘˜è‡ªå·±å»å¤„ç†ã€‚é€šå¸¸å®ƒä»¬åœ¨ã€Œåˆ°åº•ä»€ä¹ˆæ‰æ˜¯å­—ç¬¦ï¼Ÿã€è¿™ç§é‡è¦çš„é—®é¢˜ä¸Šåšå‡ºäº†å¦¥åï¼Œå®ƒä»¬åœ¨å¤„ç†å­—ç¬¦ä¸²çš„æ—¶å€™ï¼Œç›´æ¥åœ¨ç¼–ç ä¸­åŠ å…¥ä¸€äº›ã€Œè¯­æ³•ç³–ã€æ¥è®©ä»£ç æ›´åŠ æ˜“å†™ï¼Œç„¶è€Œè¿™æœ¬è´¨ä¸Šå°±ä¼šå¯¼è‡´å„ç§å›°éš¾çš„å‘ç”Ÿã€‚Swift è¯­æ³•å¯èƒ½æ²¡é‚£ä¹ˆã€Œç”œã€ï¼Œç›¸ååˆ™æ˜¯åœ¨å‘Šè¯‰ä½ å®é™…ä¸Šä¼šå‘ç”Ÿä»€ä¹ˆã€‚å¯¹äºç¨‹åºå‘˜æ¥è¯´ï¼Œè¿™ä¼šæ¯”è¾ƒå›°éš¾ï¼Œä½†å…¶å®ä¹Ÿå°±åªæœ‰è¿™äº›å›°éš¾ã€‚

`String` çš„ API ä¸­ä¹Ÿæœ‰ä¸€äº›å‘ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸€äº›å…¶ä»–çš„æ–¹æ³•æ¥è®©æ“ä½œç¨å¾®ç®€å•ä¸€äº›ã€‚ç‰¹åˆ«åœ°ï¼Œä» UTF-8 æˆ– UTF-16 è½¬æ¢æˆä¸€ä¸ª `String` ç±»å‹çš„æ•°æ®æ˜¯ä¸€ä»¶å›°éš¾è€Œåˆçƒ¦äººçš„äº‹ã€‚å¦‚æœæˆ‘ä»¬æœ‰ä¸€äº›èƒ½å¤Ÿå°†ä»»æ„ä¸€ä¸²ç å…ƒåºåˆ—è½¬æ¢æˆå­—ç¬¦ä¸²çš„ `UTF8View` å’Œ `UTF16View` æ„é€ æ–¹æ³•ï¼Œä»¥åŠå¦å¤–ä¸€äº›ç›´æ¥å»ºç«‹åœ¨è¿™äº›è§†å›¾ä¸Šçš„è½¬æ¢æ–¹æ³•ï¼Œé‚£ä¹ˆ Swift ä¸­çš„ `String` ç±»å‹å°†å˜å¾—æ›´åŠ å‹å¥½ã€‚

ä»Šå¤©å°±åˆ°è¿™é‡Œäº†ã€‚å¸Œæœ›ä¸‹æ¬¡è¿˜èƒ½ç»™å¤§å®¶å¸¦æ¥æ›´å¤šæƒŠå–œã€‚å‘¨äº”é—®ç­”çš„ä¸»é¢˜æ˜¯æ ¹æ®å¤§å®¶çš„æƒ³æ³•äº§ç”Ÿçš„ï¼Œæ‰€ä»¥è®°å¾—[ç»™æˆ‘ä»¬å†™ä¿¡æ¥æå‡ºä½ æƒ³è¦å¬çš„è¯é¢˜](mailto:mike@mikeash.com)ã€‚